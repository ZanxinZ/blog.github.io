<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>各种设计模式 | CodePaper</title><meta name=keywords content="设计模式"><meta name=description content="Creational Object Created Pattern
Factory Method Provide the method for creating an instance in the superclass, and allow the subclass to choose the type of the instance.
在父类中提供创建对象的方法，允许子类决定实例化对象的类型。
具备的部分：生产者协议、产品协议，往后就可以根据需要来扩展每一种产品。
具体的生产者比如 MongoCakeCreator 的存在是为了实现与产品相关的核心业务逻辑，而不仅仅是创建 MongoCake 实例。工厂方法将核心业务逻辑从具体产品类中分离出来。
// Creator protocol CakeCreator { func createCake() -> Cake func doSomethingForCake(cake: Cake) -> Cake } // Product protocol Cake { func doWork() } // ConcreteCreator class MongoCakeCreator: CakeCreator { var cake: MongoCake? func createCake() -> Cake { var cake = MongoCake() doSomethingForCake(cake: cake) return cake } func doSomethingForCake(cake: Cake) -> Cake{ cake."><meta name=author content><link rel=canonical href=https://1-1.link/post/design-pattern/all-design-pattern/><link crossorigin=anonymous href=/assets/css/stylesheet.6e97a6b79be998515e8c86c68e32a9f7a90e6917f550d2af32568b717f5ca785.css integrity="sha256-bpemt5vpmFFejIbGjjKp96kOaRf1UNKvMlaLcX9cp4U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://1-1.link/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://1-1.link/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://1-1.link/favicon-32x32.png><link rel=apple-touch-icon href=https://1-1.link/apple-touch-icon.png><link rel=mask-icon href=https://1-1.link/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="各种设计模式"><meta property="og:description" content="Creational Object Created Pattern
Factory Method Provide the method for creating an instance in the superclass, and allow the subclass to choose the type of the instance.
在父类中提供创建对象的方法，允许子类决定实例化对象的类型。
具备的部分：生产者协议、产品协议，往后就可以根据需要来扩展每一种产品。
具体的生产者比如 MongoCakeCreator 的存在是为了实现与产品相关的核心业务逻辑，而不仅仅是创建 MongoCake 实例。工厂方法将核心业务逻辑从具体产品类中分离出来。
// Creator protocol CakeCreator { func createCake() -> Cake func doSomethingForCake(cake: Cake) -> Cake } // Product protocol Cake { func doWork() } // ConcreteCreator class MongoCakeCreator: CakeCreator { var cake: MongoCake? func createCake() -> Cake { var cake = MongoCake() doSomethingForCake(cake: cake) return cake } func doSomethingForCake(cake: Cake) -> Cake{ cake."><meta property="og:type" content="article"><meta property="og:url" content="https://1-1.link/post/design-pattern/all-design-pattern/"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-07-11T18:27:35+08:00"><meta property="article:modified_time" content="2022-07-11T18:27:35+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="各种设计模式"><meta name=twitter:description content="Creational Object Created Pattern
Factory Method Provide the method for creating an instance in the superclass, and allow the subclass to choose the type of the instance.
在父类中提供创建对象的方法，允许子类决定实例化对象的类型。
具备的部分：生产者协议、产品协议，往后就可以根据需要来扩展每一种产品。
具体的生产者比如 MongoCakeCreator 的存在是为了实现与产品相关的核心业务逻辑，而不仅仅是创建 MongoCake 实例。工厂方法将核心业务逻辑从具体产品类中分离出来。
// Creator protocol CakeCreator { func createCake() -> Cake func doSomethingForCake(cake: Cake) -> Cake } // Product protocol Cake { func doWork() } // ConcreteCreator class MongoCakeCreator: CakeCreator { var cake: MongoCake? func createCake() -> Cake { var cake = MongoCake() doSomethingForCake(cake: cake) return cake } func doSomethingForCake(cake: Cake) -> Cake{ cake."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://1-1.link/post/"},{"@type":"ListItem","position":3,"name":"各种设计模式","item":"https://1-1.link/post/design-pattern/all-design-pattern/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"各种设计模式","name":"各种设计模式","description":"Creational Object Created Pattern\nFactory Method Provide the method for creating an instance in the superclass, and allow the subclass to choose the type of the instance.\n在父类中提供创建对象的方法，允许子类决定实例化对象的类型。\n具备的部分：生产者协议、产品协议，往后就可以根据需要来扩展每一种产品。\n具体的生产者比如 MongoCakeCreator 的存在是为了实现与产品相关的核心业务逻辑，而不仅仅是创建 MongoCake 实例。工厂方法将核心业务逻辑从具体产品类中分离出来。\n// Creator protocol CakeCreator { func createCake() -\u0026gt; Cake func doSomethingForCake(cake: Cake) -\u0026gt; Cake } // Product protocol Cake { func doWork() } // ConcreteCreator class MongoCakeCreator: CakeCreator { var cake: MongoCake? func createCake() -\u0026gt; Cake { var cake = MongoCake() doSomethingForCake(cake: cake) return cake } func doSomethingForCake(cake: Cake) -\u0026gt; Cake{ cake.","keywords":["设计模式"],"articleBody":"Creational Object Created Pattern\nFactory Method Provide the method for creating an instance in the superclass, and allow the subclass to choose the type of the instance.\n在父类中提供创建对象的方法，允许子类决定实例化对象的类型。\n具备的部分：生产者协议、产品协议，往后就可以根据需要来扩展每一种产品。\n具体的生产者比如 MongoCakeCreator 的存在是为了实现与产品相关的核心业务逻辑，而不仅仅是创建 MongoCake 实例。工厂方法将核心业务逻辑从具体产品类中分离出来。\n// Creator protocol CakeCreator { func createCake() -\u003e Cake func doSomethingForCake(cake: Cake) -\u003e Cake } // Product protocol Cake { func doWork() } // ConcreteCreator class MongoCakeCreator: CakeCreator { var cake: MongoCake? func createCake() -\u003e Cake { var cake = MongoCake() doSomethingForCake(cake: cake) return cake } func doSomethingForCake(cake: Cake) -\u003e Cake{ cake.doWork() cake.doWork() return cake } } // ConcreteCreator class ChocolateCakeCreator: CakeCreator { func createCake() -\u003e Cake { var cake = ChocolateCake() doSomethingForCake(cake: cake) return cake } func doSomethingForCake(cake: Cake) -\u003e Cake{ cake.doWork() return cake } } class MongoCake: Cake { func doWork() { print(\"Add some mongo\") } } class ChocolateCake: Cake { func doWork() { print(\"Add some chocolate\") } } // If we want to add a type of cake call \"PinapleCake\", just need to // make it conform to Cake and add a creator that conform to the CakeCreator for the \"PinapleCake\" let cakeOne = MongoCakeCreator().createCake() Abstract Factory Base on the factory method, add an abstract factory. We can call the same abstract factory method to create different mode’s product. If we want to create another mode’s product, we need to change the concrete factory.\n基于工厂方法模式，我们添加了一个抽象工厂协议，其它具体的工厂来实现这个工厂协议。从而我们可以调用同一个抽象工厂方法来创建不同模式的相似产品（比如 WinButton 和 MacButton）。如果想要切换模式，我们需要切换到另外一种具体的工厂实现。\n// Abstract factory protocol GUIFactory { func createButton() -\u003e Button func createCheckBox() -\u003e CheckBox } // Concrete factory class WinGUIFactory: GUIFactory { func createButton() -\u003e Button { var btn = WinButton() return btn } func createCheckBox() -\u003e CheckBox { var box = WinCheckBox() return box } } // Concrete factory class MacGUIFactory: GUIFactory { func createButton() -\u003e Button { var btn = MacButton() return btn } func createCheckBox() -\u003e CheckBox { var box = MacCheckBox() return box } } // Abstract product protocol Button { func click() } // Abstract product protocol CheckBox { func render() } // Concrete product class WinButton: Button { func click() { print(\"Win click button\") } } // Concrete product class WinCheckBox: CheckBox { func render() { print(\"Here the win render checkBox\") } } // Concrete product class MacButton: Button { func click() { print(\"Mac click button\") } } // Concrete product class MacCheckBox: CheckBox { func render() { print(\"Here the mac render checkBox\") } } class App { var factory: GUIFactory init(factory: GUIFactory) { self.factory = factory } func someOperation() { var checkBox = factory.createCheckBox() checkBox.render() } } let factory = WinGUIFactory() let app = App(factory: factory) // The mode is choosen now, and the behavior in the app is specific. let button = app.factory.createButton(); button.click() app.someOperation() Builder Extracting the instance’s building code from the instance’s class, and put the code into a “Builder” object to do the build work. So we can build different complex instance by using different composition of the builder method. Besides, Add a “director” to manage the calling form client.\n将对象的构造代码从对象的产品类代码中抽离出来，将这些代码放置在一个名为 “生成器” 的独立对象中。 所以，我们可以通过在建造方法中使用不同的组合，来创建不同的复杂实例。并且，增加一个 “指挥者” 来管理那些来自外界客户对调用。\n// Director class HouseDirector{ var builder: HouseBuilder init (builder: HouseBuilder) { self.builder = builder } func changeBuilder(bulider: HouseBuilder) { self.builder = bulider } // The function \"make\" define the house must built by some componets. func make(type: String) { builder.reset() if type == \"simple\" { builder.buildA() } else { builder.buildB() builder.buildC() } } } // Builder protocol HouseBuilder { func reset() func buildA() func buildB() func buildC() } class Builder1: HouseBuilder { private var result: Product1? func reset() { result = Product1() } func buildA() { } func buildB() { } func buildC() { } func getResult() -\u003e Product1? { return result } } class Builder2: HouseBuilder { private var result: Product2? func reset() { result = Product2() } func buildA() { } func buildB() { } func buildC() { } func getResult() -\u003e Product2? { return result } } class Product1 { } class Product2 { } let b = Builder1() let director = HouseDirector(builder: b) director.make(type: \"complex\") Singleton Singleton can solve two problem:\nKeep that one specific class have only one instance Provide a global access node for this instance Implementation:\nSet the default initializer as private to prevent other objects use it. Create a static func that will call the default initializer if the single instance is null, then this class will have this only one instance. 单例模式解决了可以解决两个问题：\n保证某个类只有一个实例 为这个实例提供全局的访问节点 实现：\n将默认的构造函数设置为私有，让其它对象无法访问。 新建一个静态函数，在这个函数内进行判断，若单例对象为空，则调用私有的构造函数来创建实例对象，实例只被创建一次。 class FileAccess { private static var obj: FileAccess? = nil private init(){ } public static func getInstance() { if obj == nil { obj = FileAccess() } } } let firstAccess = FileAccess.getInstance() let secondAccess = FileAccess.getInstance() // These two access are reference to a same instance. Prototype When we want to clone the instance itself, it may create some dependencies between the client and the original class, it will make the code be more complex. So we use “prototype” to compound the clone operation into the original class itself. And the clone operation will be easily.\n当我们想要完全复制一个对象它本身时，很可能会在调用者和源类之间产生一些复杂当耦合关系。所以我们使用“原型”模式，将对象克隆操作整合在对象当源类之中。这样一来，克隆操作由特定的类自身决定，调用变得简洁。\n// Prototype protocol StorePrototype{ func clone() -\u003e Store } // Concrete Prototype class Store: StorePrototype { var area: [Int] = [0, 0] init(store: StorePrototype) { if let s = store as? Store { self.area = s.area } } init() {} func clone() -\u003e Store { return Store(store: self) } } // Sub Concrete Prototype class BookStore: Store { var bookSelfCount = 0 init(bookStore: StorePrototype) { super.init(store: bookStore) if let s = bookStore as? BookStore { self.bookSelfCount = s.bookSelfCount } } override init() { super.init() } override func clone() -\u003e Store { return BookStore(bookStore: self) } } // Sub Concrete Prototype class FlowerStore: Store { var flowers = [\"Sun Flower\", \"Rose\", \"Lily\"] init(flowerStore: StorePrototype) { super.init(store: flowerStore) if let s = flowerStore as? FlowerStore { self.flowers = s.flowers } } override init() { super.init() } override func clone() -\u003e Store { return FlowerStore(flowerStore: self) } } let store = Store() let obj = FlowerStore() let copyStore = store.clone() let copyObj = obj.clone() // Now it did the deep copy. It copy the whole instance \"store\" to \"copyStore\", and copy the whole instace \"obj\" to copyObj. Structural Adapter A class called ‘A’ needs to disguise as another class called ‘B’, create a new adapter to extend the target class B and then insert the class A into the adapter, override the methods from the class B in the adapter. So we can use the adapter which has new features from A, just like we are using class B(The adapter extends from class B).\n类 A 想要适配类 B，首先使用一个适配器继承类 B ，把类 A 注入适配器，在适配器里面重写需 要模仿的类 B 的方法。最后，在需要用 A 替换 B 的地方，传递一个适配器即可，因为它既具有 A 的性质，又具有 B 的方法，它继承自 B ，可以当作 B 来调用。\nclass Bike { var name = \"deafult\" func go() { print(\"Bike Go\") } func addWheel() { print(\"Add wheel for\\(name)\") } } class WaterBike { var weight = 0 func floating() { print(\"The water bike floating on the water\") } } // now the water bike adapt the bike, inherit the target(Bike) that be disguised. class WaterBikeAdapter: Bike { var waterBike: WaterBike? init(waterBike: WaterBike) { self.waterBike = waterBike // inject the waterBike(which want to disguise as other) } override func go() { print(\"Now it's the water bike go\") } } func someThingGo(bike: Bike) { bike.go() } // This mode make the \"WaterBike\" to disguise as a \"Bike\" let waterBikeAdapter = WaterBikeAdapter(waterBike: WaterBike()) // The adapter has a waterBike and has the method of bike. someThingGo(bike: waterBikeAdapter) // Now it can use as a bike. Bridge It depart one class or some closing class into two independent layer, the abstract and the implementation. The concrete class A contains an abstract interface B, and this interface can be implement in different ways. The A relies on the interface B not the concrete class. We inject different concrete class（has implemented interface B） for A or subclass of A, so we can get an instance of A or subclass with different functionality.\n桥接模式将一个大类或者一系列紧密相关的类拆分为抽象和实现两个独立的层次结构。实体类 A 包含有接口 B，这个接口可以通过不同的方式来实现。实体类 A 依赖于接口 B 而不是具体的类。 我们使用不同的实现了接口 B 的实体类注入到 A 类实体或者 A类的子类的实体中，从而可以得到具有不同功能的 A 实体 或者 A 子类实体。\n// Abstract interface protocol Device { func isEnable() -\u003e Bool func enable() func disable() func getVolume() -\u003e Int func setVolume(_ volumn: Int) func getChannel() -\u003e Int func setChannel(_ channel: Int) } // Concrete class that contains the interface class Remote { var device: Device init(_ device: Device) { self.device = device } func togglePower() { if device.isEnable() { device.disable() } else { device.enable() } } func volumeUp() { device.setVolume(device.getVolume() + 1) } func voluomeDown() { device.setVolume(device.getVolume() - 1) } func channelUp() { device.setChannel(device.getChannel() + 1) } func channelDown() { device.setChannel(device.getChannel() - 1) } } // Sub class class AdvanceRemote: Remote { override init(_ device: Device) { super.init(device) } func mute() { device.setVolume(0) } } // Specific implementation of the interface class TV: Device { private var displaySize = (1080, 960) private var on: Bool = false private var volume = 0 private var channel = 0 func isEnable() -\u003e Bool { return on } func enable() { self.on = true } func disable() { self.on = false } func getVolume() -\u003e Int { return volume } func setVolume(_ volumn: Int) { self.volume = volumn } func getChannel() -\u003e Int { return channel } func setChannel(_ channel: Int) { self.channel = channel } } // Specific implementation of the interface class Radio: Device { private var on: Bool = false private var volume = 0 private var channel = 0 func isEnable() -\u003e Bool { return on } func enable() { on = true } func disable() { on = false } func getVolume() -\u003e Int { return volume } func setVolume(_ volumn: Int) { self.volume = volumn } func getChannel() -\u003e Int { return channel } func setChannel(_ channel: Int) { self.channel = channel } } let tv = TV() // create a TV let remote = AdvanceRemote(tv) // inject a concrete Device to the remote. remote.togglePower() remote.channelUp() remote.volumeUp() remote.mute() let radio = Radio() let remoteForRadio = Remote(radio) remoteForRadio.channelUp() remoteForRadio.togglePower() Composite We want to make the client using the Container or Leafs in a same calling way, so we set the leaf and the container that implement the same interface (Component). And the Container contains some children. In this way we create a model like tree, the client can treat every node similarly.\n为了使客户端能够使用相同的方式调用 “容器” 和 “叶子”，我们让容器和叶子都去实现同一个接口 “组件”。并且容器中包含有一些子的容器。通过这种方式，我们可以创建一个类似于一棵树的模型，客户端对每个结点使用相同的对待方式。\n// interface protocol Component { func execute() } class Leaf: Component { func execute() { print(\"I'm leaf\") } } class SubLeaf: Leaf { override func execute() { print(\"I'm sub leaf\") } } // Composite class Containner:Component { private var children: [Component] = [] func add(c: Component) { children.append(c) } func remove(c: Component) { } func execute() { for item in children { item.execute() } } } // We treat the leaf and the containner as the same type of node. let leaf = Leaf() let leafTwo = Leaf() let subLeaf = SubLeaf() let c = Containner() c.add(c: leaf) c.add(c: leafTwo) let root = Containner() root.add(c: c) root.add(c: subLeaf) c.execute() root.execute() Decorator The components and decorators are departed, we can add new components and decorators freely. And we can make different compositions(with different decorations) to be different products.\n组件模块和装饰器是分开的，我们可以自由地添加组件和装饰器。我们也可使用不同的组合形式（基于不同装饰方式），来得到不同的产品。\n// Base interface between classes. protocol Component { var text: String? { get set} func execute() } // Concrete Component class Bike: Component { var text: String? func execute() { text = \"bike\" } } // Concrete Component class Moto: Component { var text: String? func execute() { text = \"moto\" } } // Base Decorator class BaseDecorator: Component { var text: String? private var c: Component func execute() { c.execute() if let t = c.text { text = \"\u003c\" + t + \"\u003e\" // Here the text is the property of the current concrete decorator. } else { text = \"\u003c\u003e\" } } func getText() -\u003e String { if let s = text { return s } else { return \"\" } } func setText(_ str: String?) { text = str } func getC() -\u003e Component { return c } // inject an instance init(_ c: Component) { self.c = c } } // Concrete Decorator class PaintDecorator: BaseDecorator { override func execute() { super.execute() extra() } func extra() { let s = getText() setText(\"(Paint)\\(s)(Paint)\") } } // Concrete Decorator class AttachTagDecorator: BaseDecorator { override func execute() { super.execute() extra() } func extra() { let s = getText() setText(\"(Tag)\\(s)(Tag)\") } } let a = Bike() let tag = AttachTagDecorator(a) let paint = PaintDecorator(tag) paint.execute() // (Paint)\u003c(Tag)(Tag)\u003e(Paint) print(paint.getText()) let b = Moto() let bpaint = PaintDecorator(b) let bTag = AttachTagDecorator(bpaint) bTag.execute() // (Tag)\u003c(Paint)(Paint)\u003e(Tag) print(bTag.getText()) Facade The sub-system has many objects and we want to decoupling them with the client’s calling, so we set a class Facade and use its instance to interact with the sub-system. The Facade just like an inter-media.\n一个子系统有许多对象，而我们想要将这些对象与客户端调用解耦合，所以我们设置一个 “外观” 类，使用外观类的实例来与子系统交互。这个外观类实例就像一个处于中间的媒介。\n// Sub-System objects class VideoFile { } class BitwiseNot { } class CvtColor { } class Transformer { } // Facade class VideoConverter { func convert() -\u003e File { var videoFile = VideoFile() var bitwiseNot = BitwiseNot() var cvtColor = CvtColor() var transformer = Transformer() var file = File() return file } } class File { } let converter = VideoConverter() var file = converter.convert() Flyweight The flyweight is to make the memory can load more objects. An object may have some properties that is repeating, and it take many memory space, we move these properties into another class(called Flyweight), and the original class just hold a reference of the Flyweight instance.\n享元可以使内存能加载更多的对象。一个对象可能会拥有一些重复的、占用空间大的属性，我们将这些属性移到另外的一个类中（这个类称为享元），然后原来的类就只是持有一个享元实例的引用。\n// Client class Game { var bullets: [Bullet] = [] var factory: Factory func creatBullet(_ count: Int) { for i in 0..","wordCount":"5473","inLanguage":"en","datePublished":"2022-07-11T18:27:35+08:00","dateModified":"2022-07-11T18:27:35+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://1-1.link/post/design-pattern/all-design-pattern/"},"publisher":{"@type":"Organization","name":"CodePaper","logo":{"@type":"ImageObject","url":"https://1-1.link/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://1-1.link accesskey=h title="CodePaper (Alt + H)">CodePaper</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://1-1.link/archive/ title=档案><span>档案</span></a></li><li><a href=https://1-1.link/categories/ title=类别><span>类别</span></a></li><li><a href=https://1-1.link/tags/ title=标签><span>标签</span></a></li><li><a href=https://1-1.link/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://1-1.link/about/ title=关于我><span>关于我</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://1-1.link>Home</a>&nbsp;»&nbsp;<a href=https://1-1.link/post/>Posts</a></div><h1 class=post-title>各种设计模式</h1><div class=post-meta><span title='2022-07-11 18:27:35 +0800 +0800'>July 11, 2022</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#creational aria-label=Creational>Creational</a><ul><li><a href=#factory-method aria-label="Factory Method">Factory Method</a></li><li><a href=#abstract-factory aria-label="Abstract Factory">Abstract Factory</a></li><li><a href=#builder aria-label=Builder>Builder</a></li><li><a href=#singleton aria-label=Singleton>Singleton</a></li><li><a href=#prototype aria-label=Prototype>Prototype</a></li></ul></li><li><a href=#structural aria-label=Structural>Structural</a><ul><li><a href=#adapter aria-label=Adapter>Adapter</a></li><li><a href=#bridge aria-label=Bridge>Bridge</a></li><li><a href=#composite aria-label=Composite>Composite</a></li><li><a href=#decorator aria-label=Decorator>Decorator</a></li><li><a href=#facade aria-label=Facade>Facade</a></li><li><a href=#flyweight aria-label=Flyweight>Flyweight</a></li><li><a href=#proxy aria-label=Proxy>Proxy</a></li><li><a href=#delegate aria-label=Delegate>Delegate</a></li></ul></li><li><a href=#behavioral aria-label=Behavioral>Behavioral</a><ul><li><a href=#chain-of-responsibility aria-label="Chain of Responsibility">Chain of Responsibility</a></li><li><a href=#command aria-label=Command>Command</a></li><li><a href=#iterator aria-label=Iterator>Iterator</a></li><li><a href=#mediator aria-label=Mediator>Mediator</a></li><li><a href=#memento aria-label=Memento>Memento</a></li><li><a href=#observer aria-label=Observer>Observer</a></li><li><a href=#state aria-label=State>State</a></li><li><a href=#strategy aria-label=Strategy>Strategy</a></li><li><a href=#template-method aria-label="Template Method">Template Method</a></li><li><a href=#visitor aria-label=Visitor>Visitor</a></li></ul></li><li><a href=#%e6%a8%a1%e5%bc%8f%e7%9a%84%e7%89%b9%e5%be%81%e4%b8%8e%e5%8c%ba%e5%88%ab aria-label=模式的特征与区别>模式的特征与区别</a><ul><li><a href=#%e7%bb%93%e6%9e%84%e5%9e%8b aria-label=结构型>结构型</a></li><li><a href=#%e8%a1%8c%e4%b8%ba%e5%9e%8b aria-label=行为型>行为型</a></li></ul></li></ul></div></details></div><div class=post-content><h2 id=creational>Creational<a hidden class=anchor aria-hidden=true href=#creational>#</a></h2><p>Object Created Pattern</p><h3 id=factory-method>Factory Method<a hidden class=anchor aria-hidden=true href=#factory-method>#</a></h3><p>Provide the method for creating an instance in the superclass, and allow the subclass to choose the type of the instance.</p><p>在父类中提供创建对象的方法，允许子类决定实例化对象的类型。</p><p>具备的部分：生产者协议、产品协议，往后就可以根据需要来扩展每一种产品。</p><p><img loading=lazy src=../imgs/factory.png alt=factory></p><p>具体的生产者比如 <code>MongoCakeCreator</code> 的存在是为了实现与产品相关的核心业务逻辑，而不仅仅是创建 <code>MongoCake</code> 实例。工厂方法将核心业务逻辑从具体产品类中分离出来。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#75715e>// Creator</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>CakeCreator</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>createCake</span>() -&gt; Cake
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>doSomethingForCake</span>(cake: Cake) -&gt; Cake
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Product</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>Cake</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>doWork</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ConcreteCreator</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MongoCakeCreator</span>: CakeCreator {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> cake: MongoCake?
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>createCake</span>() -&gt; Cake {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> cake = MongoCake()
</span></span><span style=display:flex><span>            doSomethingForCake(cake: cake)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> cake
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>doSomethingForCake</span>(cake: Cake) -&gt; Cake{
</span></span><span style=display:flex><span>            cake.doWork()
</span></span><span style=display:flex><span>            cake.doWork()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> cake
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ConcreteCreator</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ChocolateCakeCreator</span>: CakeCreator {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>createCake</span>() -&gt; Cake {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> cake = ChocolateCake()
</span></span><span style=display:flex><span>            doSomethingForCake(cake: cake)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> cake
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>doSomethingForCake</span>(cake: Cake) -&gt; Cake{
</span></span><span style=display:flex><span>            cake.doWork()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> cake
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MongoCake</span>: Cake {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>doWork</span>() {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Add some mongo&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ChocolateCake</span>: Cake {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>doWork</span>() {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Add some chocolate&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// If we want to add a type of cake call &#34;PinapleCake&#34;, just need to </span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// make it conform to Cake and add a creator that conform to the CakeCreator for the &#34;PinapleCake&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> cakeOne = MongoCakeCreator().createCake()
</span></span></code></pre></div><h3 id=abstract-factory>Abstract Factory<a hidden class=anchor aria-hidden=true href=#abstract-factory>#</a></h3><p>Base on the factory method, add an abstract factory. We can call the same abstract factory method to create different mode’s product. If we want to create another mode’s product, we need to change the concrete factory.</p><p>基于工厂方法模式，我们添加了一个抽象工厂协议，其它具体的工厂来实现这个工厂协议。从而我们可以调用同一个抽象工厂方法来创建不同模式的相似产品（比如 WinButton 和 MacButton）。如果想要切换模式，我们需要切换到另外一种具体的工厂实现。</p><p><img loading=lazy src=../imgs/abstractFactory.png alt=abstractFactory></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#75715e>// Abstract factory</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>GUIFactory</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>createButton</span>() -&gt; Button
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>createCheckBox</span>() -&gt; CheckBox
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete factory</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WinGUIFactory</span>: GUIFactory {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>createButton</span>() -&gt; Button {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> btn = WinButton()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> btn
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>createCheckBox</span>() -&gt; CheckBox {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> box = WinCheckBox()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> box
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete factory</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MacGUIFactory</span>: GUIFactory {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>createButton</span>() -&gt; Button {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> btn = MacButton()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> btn
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>createCheckBox</span>() -&gt; CheckBox {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> box = MacCheckBox()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> box
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Abstract product</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>Button</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>click</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Abstract product</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>CheckBox</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>render</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete product</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WinButton</span>: Button {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>click</span>() {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Win click button&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete product</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WinCheckBox</span>: CheckBox {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>render</span>() {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Here the win render checkBox&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete product</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MacButton</span>: Button {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>click</span>() {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Mac click button&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete product</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MacCheckBox</span>: CheckBox {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>render</span>() {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Here the mac render checkBox&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>App</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> factory: GUIFactory
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(factory: GUIFactory) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.factory = factory
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>someOperation</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> checkBox = factory.createCheckBox()
</span></span><span style=display:flex><span>            checkBox.render()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> factory = WinGUIFactory()           
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> app = App(factory: factory)         <span style=color:#75715e>// The mode is choosen now, and the behavior in the app is specific.</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> button = app.factory.createButton();
</span></span><span style=display:flex><span>    button.click()
</span></span><span style=display:flex><span>    app.someOperation()
</span></span></code></pre></div><h3 id=builder>Builder<a hidden class=anchor aria-hidden=true href=#builder>#</a></h3><p>Extracting the instance’s building code from the instance’s class, and put the code into a “Builder” object to do the build work. So we can build different complex instance by using different composition of the builder method. Besides, Add a “director” to manage the calling form client.</p><p>将对象的构造代码从对象的产品类代码中抽离出来，将这些代码放置在一个名为 “生成器” 的独立对象中。 所以，我们可以通过在建造方法中使用不同的组合，来创建不同的复杂实例。并且，增加一个 “指挥者” 来管理那些来自外界客户对调用。</p><p><img loading=lazy src=../imgs/builder.png alt=builder></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#75715e>// Director</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HouseDirector</span>{
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> builder: HouseBuilder
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span> (builder: HouseBuilder) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.builder = builder
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>changeBuilder</span>(bulider: HouseBuilder) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.builder = bulider
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#75715e>// The function &#34;make&#34; define the house must built by some componets. </span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>make</span>(type: String) {
</span></span><span style=display:flex><span>            builder.reset()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> type == <span style=color:#e6db74>&#34;simple&#34;</span> {
</span></span><span style=display:flex><span>                builder.buildA()
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                builder.buildB()
</span></span><span style=display:flex><span>                builder.buildC()
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Builder</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>HouseBuilder</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>reset</span>()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>buildA</span>()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>buildB</span>()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>buildC</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Builder1</span>: HouseBuilder {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> result: Product1?
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>reset</span>() {
</span></span><span style=display:flex><span>            result = Product1()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>buildA</span>() {
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>buildB</span>() {
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>buildC</span>() {
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getResult</span>() -&gt; Product1? {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> result
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Builder2</span>: HouseBuilder {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> result: Product2?
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>reset</span>() {
</span></span><span style=display:flex><span>            result = Product2()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>buildA</span>() {
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>buildB</span>() {
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>buildC</span>() {
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getResult</span>() -&gt; Product2? {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> result
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Product1</span> {
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Product2</span> {
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> b = Builder1()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> director = HouseDirector(builder: b)
</span></span><span style=display:flex><span>    director.make(type: <span style=color:#e6db74>&#34;complex&#34;</span>)
</span></span></code></pre></div><h3 id=singleton>Singleton<a hidden class=anchor aria-hidden=true href=#singleton>#</a></h3><p>Singleton can solve two problem:</p><ul><li>Keep that one specific class have only one instance</li><li>Provide a global access node for this instance</li></ul><p>Implementation:</p><ul><li>Set the default initializer as private to prevent other objects use it.</li><li>Create a static func that will call the default initializer if the single instance is null, then this class will have this only one instance.</li></ul><p>单例模式解决了可以解决两个问题：</p><ul><li>保证某个类只有一个实例</li><li>为这个实例提供全局的访问节点</li></ul><p>实现：</p><ul><li>将默认的构造函数设置为私有，让其它对象无法访问。</li><li>新建一个静态函数，在这个函数内进行判断，若单例对象为空，则调用私有的构造函数来创建实例对象，实例只被创建一次。</li></ul><p><img loading=lazy src=../imgs/signleton.png alt=singleton></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>        <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FileAccess</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>var</span> obj: FileAccess? = <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>init</span>(){
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getInstance</span>() {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> obj == <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                    obj = FileAccess()
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> firstAccess = FileAccess.getInstance()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> secondAccess = FileAccess.getInstance()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// These two access are reference to a same instance.</span>
</span></span></code></pre></div><h3 id=prototype>Prototype<a hidden class=anchor aria-hidden=true href=#prototype>#</a></h3><p>When we want to clone the instance itself, it may create some dependencies between the client and the original class, it will make the code be more complex. So we use “prototype” to <strong>compound the clone operation into the original class itself</strong>. And the clone operation will be easily.</p><p>当我们想要完全复制一个对象它本身时，很可能会在调用者和源类之间产生一些复杂当耦合关系。所以我们使用“原型”模式，将对象克隆操作整合在对象当源类之中。这样一来，克隆操作由特定的类自身决定，调用变得简洁。</p><p><img loading=lazy src=../imgs/prototype.png alt=prototype></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#75715e>// Prototype</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>StorePrototype</span>{
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>clone</span>() -&gt; Store
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete Prototype</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Store</span>: StorePrototype {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> area: [Int] = [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(store: StorePrototype) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> s = store <span style=color:#66d9ef>as</span>? Store {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>self</span>.area = s.area
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>() {}
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>clone</span>() -&gt; Store {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> Store(store: <span style=color:#66d9ef>self</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Sub Concrete Prototype</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BookStore</span>: Store {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> bookSelfCount = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(bookStore: StorePrototype) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span>.<span style=color:#66d9ef>init</span>(store: bookStore)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> s = bookStore <span style=color:#66d9ef>as</span>? BookStore {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>self</span>.bookSelfCount = s.bookSelfCount
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>init</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span>.<span style=color:#66d9ef>init</span>()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>clone</span>() -&gt; Store {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> BookStore(bookStore: <span style=color:#66d9ef>self</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Sub Concrete Prototype</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FlowerStore</span>: Store {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> flowers = [<span style=color:#e6db74>&#34;Sun Flower&#34;</span>, <span style=color:#e6db74>&#34;Rose&#34;</span>, <span style=color:#e6db74>&#34;Lily&#34;</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(flowerStore: StorePrototype) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span>.<span style=color:#66d9ef>init</span>(store: flowerStore)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> s = flowerStore <span style=color:#66d9ef>as</span>? FlowerStore {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>self</span>.flowers = s.flowers
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>init</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span>.<span style=color:#66d9ef>init</span>()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>clone</span>() -&gt; Store {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> FlowerStore(flowerStore: <span style=color:#66d9ef>self</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> store = Store()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> obj = FlowerStore()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> copyStore = store.clone()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> copyObj = obj.clone()        
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Now it did the deep copy. It copy the whole instance &#34;store&#34; to &#34;copyStore&#34;, and copy the whole instace &#34;obj&#34; to copyObj.</span>
</span></span></code></pre></div><h2 id=structural>Structural<a hidden class=anchor aria-hidden=true href=#structural>#</a></h2><h3 id=adapter>Adapter<a hidden class=anchor aria-hidden=true href=#adapter>#</a></h3><p>A class called ‘A’ needs to disguise as another class called ‘B’, create a new adapter to extend the target class B and then insert the class A into the adapter, override the methods from the class B in the adapter. So we can use the adapter which has new features from A, just like we are using class B(The adapter extends from class B).</p><p>类 A 想要适配类 B，首先使用一个适配器继承类 B ，把类 A 注入适配器，在适配器里面重写需 要模仿的类 B 的方法。最后，在需要用 A 替换 B 的地方，传递一个适配器即可，因为它既具有 A 的性质，又具有 B 的方法，它继承自 B ，可以当作 B 来调用。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Bike</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> name = <span style=color:#e6db74>&#34;deafult&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>go</span>() {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Bike Go&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>addWheel</span>() {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Add wheel for</span><span style=color:#e6db74>\(</span>name<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WaterBike</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> weight = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>floating</span>() {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;The water bike floating on the water&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// now the water bike adapt the bike, inherit the target(Bike) that be disguised.</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WaterBikeAdapter</span>: Bike {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> waterBike: WaterBike?
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(waterBike: WaterBike) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.waterBike = waterBike  <span style=color:#75715e>// inject the waterBike(which want to disguise as other)</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>go</span>() {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Now it&#39;s the water bike go&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>someThingGo</span>(bike: Bike) {
</span></span><span style=display:flex><span>        bike.go()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// This mode make the &#34;WaterBike&#34; to disguise as a &#34;Bike&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> waterBikeAdapter = WaterBikeAdapter(waterBike: WaterBike()) <span style=color:#75715e>// The adapter has a waterBike and  has the method of bike.</span>
</span></span><span style=display:flex><span>    someThingGo(bike: waterBikeAdapter) <span style=color:#75715e>// Now it can use as a bike.</span>
</span></span></code></pre></div><h3 id=bridge>Bridge<a hidden class=anchor aria-hidden=true href=#bridge>#</a></h3><p>It depart one class or some closing class into two independent layer, the abstract and the implementation. The concrete class A contains an abstract interface B, and <strong>this interface can be implement in different ways</strong>. The A relies on the interface B not the concrete class. We inject different concrete class（has implemented interface B） for A or subclass of A, so we can get an instance of A or subclass with different functionality.</p><p>桥接模式将一个大类或者一系列紧密相关的类拆分为<strong>抽象</strong>和<strong>实现</strong>两个独立的层次结构。实体类 A 包含有接口 B，这个接口可以通过不同的方式来实现。实体类 A 依赖于接口 B 而不是具体的类。 我们使用不同的实现了接口 B 的实体类注入到 A 类实体或者 A类的子类的实体中，从而可以得到具有不同功能的 A 实体 或者 A 子类实体。</p><p><img loading=lazy src=../imgs/bridge.png alt=bridge></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#75715e>// Abstract interface</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>Device</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>isEnable</span>() -&gt; Bool
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>enable</span>()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>disable</span>()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getVolume</span>() -&gt; Int
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>setVolume</span>(<span style=color:#66d9ef>_</span> volumn: Int)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getChannel</span>() -&gt; Int
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>setChannel</span>(<span style=color:#66d9ef>_</span> channel: Int)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete class that contains the interface</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Remote</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> device: Device
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(<span style=color:#66d9ef>_</span> device: Device) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.device = device
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>togglePower</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> device.isEnable() {
</span></span><span style=display:flex><span>                device.disable()
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                device.enable()
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>volumeUp</span>() {
</span></span><span style=display:flex><span>            device.setVolume(device.getVolume() <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>voluomeDown</span>() {
</span></span><span style=display:flex><span>            device.setVolume(device.getVolume() <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>channelUp</span>() {
</span></span><span style=display:flex><span>            device.setChannel(device.getChannel() <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>channelDown</span>() {
</span></span><span style=display:flex><span>            device.setChannel(device.getChannel() <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Sub class</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AdvanceRemote</span>: Remote {
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>init</span>(<span style=color:#66d9ef>_</span> device: Device) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span>.<span style=color:#66d9ef>init</span>(device)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>mute</span>() {
</span></span><span style=display:flex><span>            device.setVolume(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Specific implementation of the interface</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TV</span>: Device {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> displaySize = (<span style=color:#ae81ff>1080</span>, <span style=color:#ae81ff>960</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> on: Bool = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> volume = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> channel = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>isEnable</span>() -&gt; Bool {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> on
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>enable</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.on = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>disable</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.on = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getVolume</span>() -&gt; Int {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> volume
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>setVolume</span>(<span style=color:#66d9ef>_</span> volumn: Int) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.volume = volumn
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getChannel</span>() -&gt; Int {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> channel
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>setChannel</span>(<span style=color:#66d9ef>_</span> channel: Int) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.channel = channel
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Specific implementation of the interface</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Radio</span>: Device {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> on: Bool = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> volume = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> channel = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>isEnable</span>() -&gt; Bool {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> on
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>enable</span>() {
</span></span><span style=display:flex><span>            on = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>disable</span>() {
</span></span><span style=display:flex><span>            on = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getVolume</span>() -&gt; Int {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> volume
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>setVolume</span>(<span style=color:#66d9ef>_</span> volumn: Int) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.volume = volumn
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getChannel</span>() -&gt; Int {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> channel
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>setChannel</span>(<span style=color:#66d9ef>_</span> channel: Int) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.channel = channel
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> tv = TV()                     <span style=color:#75715e>// create a TV</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> remote = AdvanceRemote(tv)    <span style=color:#75715e>// inject a concrete Device to the remote.</span>
</span></span><span style=display:flex><span>    remote.togglePower()
</span></span><span style=display:flex><span>    remote.channelUp()
</span></span><span style=display:flex><span>    remote.volumeUp()
</span></span><span style=display:flex><span>    remote.mute()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> radio = Radio()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> remoteForRadio = Remote(radio)
</span></span><span style=display:flex><span>    remoteForRadio.channelUp()
</span></span><span style=display:flex><span>    remoteForRadio.togglePower()
</span></span></code></pre></div><h3 id=composite>Composite<a hidden class=anchor aria-hidden=true href=#composite>#</a></h3><p>We want to make the client using the Container or Leafs in a same calling way, so we set the leaf and the container that implement the same interface (Component). And the Container contains some children. In this way we create a model like tree, the client can treat every node similarly.</p><p>为了使客户端能够使用相同的方式调用 “容器” 和 “叶子”，我们让容器和叶子都去实现同一个接口 “组件”。并且容器中包含有一些子的容器。通过这种方式，我们可以创建一个类似于一棵树的模型，客户端对每个结点使用相同的对待方式。</p><p><img loading=lazy src=../imgs/command.png alt=composite></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#75715e>// interface</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>Component</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>execute</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Leaf</span>: Component {
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>execute</span>() {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;I&#39;m leaf&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SubLeaf</span>: Leaf {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>execute</span>() {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;I&#39;m sub leaf&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Composite</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Containner</span>:Component {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> children: [Component] = []
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>add</span>(c: Component) {
</span></span><span style=display:flex><span>            children.append(c)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>remove</span>(c: Component) {
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>execute</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> item <span style=color:#66d9ef>in</span> children {
</span></span><span style=display:flex><span>                item.execute()
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// We treat the leaf and the containner as the same type of node.</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> leaf = Leaf()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> leafTwo = Leaf()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> subLeaf = SubLeaf()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> c = Containner()
</span></span><span style=display:flex><span>    c.add(c: leaf)
</span></span><span style=display:flex><span>    c.add(c: leafTwo)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> root = Containner()
</span></span><span style=display:flex><span>    root.add(c: c)
</span></span><span style=display:flex><span>    root.add(c: subLeaf)
</span></span><span style=display:flex><span>    c.execute()
</span></span><span style=display:flex><span>    root.execute()
</span></span></code></pre></div><h3 id=decorator>Decorator<a hidden class=anchor aria-hidden=true href=#decorator>#</a></h3><p>The components and decorators are departed, we can add new components and decorators freely. And we can make different compositions(with different decorations) to be different products.</p><p>组件模块和装饰器是分开的，我们可以自由地添加组件和装饰器。我们也可使用不同的组合形式（基于不同装饰方式），来得到不同的产品。</p><p><img loading=lazy src=../imgs/decorator.png alt=decorator></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#75715e>// Base interface between classes.</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>Component</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> text: String? { <span style=color:#66d9ef>get</span> <span style=color:#66d9ef>set</span>}
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>execute</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete Component</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Bike</span>: Component {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> text: String?
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>execute</span>() {
</span></span><span style=display:flex><span>            text = <span style=color:#e6db74>&#34;bike&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete Component</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Moto</span>: Component {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> text: String?
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>execute</span>() {
</span></span><span style=display:flex><span>            text = <span style=color:#e6db74>&#34;moto&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Base Decorator</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BaseDecorator</span>: Component {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> text: String?
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> c: Component
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>execute</span>() {
</span></span><span style=display:flex><span>            c.execute()
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> t = c.text {
</span></span><span style=display:flex><span>                text = <span style=color:#e6db74>&#34;&lt;&#34;</span> <span style=color:#f92672>+</span> t <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&gt;&#34;</span>   <span style=color:#75715e>// Here the text is the property of the current concrete decorator.</span>
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                text = <span style=color:#e6db74>&#34;&lt;&gt;&#34;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }    
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getText</span>() -&gt; String {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> s = text {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> s
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>setText</span>(<span style=color:#66d9ef>_</span> str: String?) {
</span></span><span style=display:flex><span>            text = str
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getC</span>() -&gt; Component {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> c
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#75715e>// inject an instance</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(<span style=color:#66d9ef>_</span> c: Component) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.c = c
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete Decorator</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PaintDecorator</span>: BaseDecorator {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>execute</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span>.execute()
</span></span><span style=display:flex><span>            extra()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>extra</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> s = getText()
</span></span><span style=display:flex><span>            setText(<span style=color:#e6db74>&#34;(Paint)</span><span style=color:#e6db74>\(</span>s<span style=color:#e6db74>)</span><span style=color:#e6db74>(Paint)&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete Decorator</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AttachTagDecorator</span>: BaseDecorator {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>execute</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span>.execute()
</span></span><span style=display:flex><span>            extra()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>extra</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> s = getText()
</span></span><span style=display:flex><span>            setText(<span style=color:#e6db74>&#34;(Tag)</span><span style=color:#e6db74>\(</span>s<span style=color:#e6db74>)</span><span style=color:#e6db74>(Tag)&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> a = Bike()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> tag = AttachTagDecorator(a)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> paint = PaintDecorator(tag)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    paint.execute()                <span style=color:#75715e>// (Paint)&lt;(Tag)&lt;bike&gt;(Tag)&gt;(Paint)</span>
</span></span><span style=display:flex><span>    print(paint.getText())
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> b = Moto()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> bpaint = PaintDecorator(b)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> bTag = AttachTagDecorator(bpaint)
</span></span><span style=display:flex><span>    bTag.execute()                <span style=color:#75715e>// (Tag)&lt;(Paint)&lt;moto&gt;(Paint)&gt;(Tag)</span>
</span></span><span style=display:flex><span>    print(bTag.getText())
</span></span><span style=display:flex><span>    
</span></span></code></pre></div><h3 id=facade>Facade<a hidden class=anchor aria-hidden=true href=#facade>#</a></h3><p>The sub-system has many objects and we want to decoupling them with the client’s calling, so we set a class <code>Facade</code> and use its instance to interact with the sub-system. The <code>Facade</code> just like an inter-media.</p><p> 一个子系统有许多对象，而我们想要将这些对象与客户端调用解耦合，所以我们设置一个 “外观” 类，使用外观类的实例来与子系统交互。这个外观类实例就像一个处于中间的媒介。</p><p><img loading=lazy src=../imgs/facade.png alt=facade></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#75715e>// Sub-System objects</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>VideoFile</span> {
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BitwiseNot</span> {
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CvtColor</span> {
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Transformer</span> {
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Facade</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>VideoConverter</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>convert</span>() -&gt; File {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> videoFile = VideoFile()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> bitwiseNot = BitwiseNot()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> cvtColor = CvtColor()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> transformer = Transformer()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> file = File()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> file
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>File</span> {
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> converter = VideoConverter()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> file = converter.convert()
</span></span></code></pre></div><h3 id=flyweight>Flyweight<a hidden class=anchor aria-hidden=true href=#flyweight>#</a></h3><p>The flyweight is to make the memory can load more objects. An object may have some properties that is repeating, and it take many memory space, we move these properties into another class(called Flyweight), and the original class just hold a reference of the Flyweight instance.</p><p>享元可以使内存能加载更多的对象。一个对象可能会拥有一些重复的、占用空间大的属性，我们将这些属性移到另外的一个类中（这个类称为享元），然后原来的类就只是持有一个享元实例的引用。</p><p><img loading=lazy src=../imgs/flyweight.png alt=flyweight></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#75715e>// Client</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Game</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> bullets: [Bullet] = []
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> factory: Factory
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>creatBullet</span>(<span style=color:#66d9ef>_</span> count: Int) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> i <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0.</span>.&lt;count {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> b = Bullet(id: i, position: [Int.random(<span style=color:#66d9ef>in</span>: <span style=color:#ae81ff>0.</span>..<span style=color:#ae81ff>20</span>), Int.random(<span style=color:#66d9ef>in</span>: <span style=color:#ae81ff>0.</span>..<span style=color:#ae81ff>20</span>)], paint: factory.getBulletPaint(sign: BulletPaint.sign))
</span></span><span style=display:flex><span>                bullets.append(b)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>() {
</span></span><span style=display:flex><span>            factory = Factory()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Context</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Bullet</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> id: Int
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> position: [Int] = [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> paint: BulletPaint
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(id: Int, position: [Int], paint: BulletPaint) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.id = id
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.position = position
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.paint = paint
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Flyweight</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BulletPaint</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> picture: String?
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>var</span> sign = <span style=color:#ae81ff>0</span> 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>changePicture</span>(picture: String) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.picture = picture
</span></span><span style=display:flex><span>            BulletPaint.sign <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Flyweight Factory</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Factory</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> stuff: [BulletPaint] = []
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getBulletPaint</span>(sign: Int) -&gt; BulletPaint {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> stuff.count <span style=color:#f92672>&lt;=</span> sign <span style=color:#f92672>||</span> stuff[sign] == <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> paint = BulletPaint()
</span></span><span style=display:flex><span>                stuff.append(paint)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> paint
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> stuff[sign]
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> game = Game()
</span></span><span style=display:flex><span>    game.creatBullet(<span style=color:#ae81ff>100</span>)
</span></span></code></pre></div><h3 id=proxy>Proxy<a hidden class=anchor aria-hidden=true href=#proxy>#</a></h3><p>A class <code>Proxy</code> and a class <code>Service</code> both conform to the same protocol <code>ServiceInterface</code>, and <code>Proxy</code> want to give some of its method to done by <code>Service</code>, so <code>Proxy</code> just keep a reference of <code>Service</code> and call the <code>Service</code> when <code>Proxy</code> it want to solve some problem.</p><p>一个名为 “代理” 的类和一个名为 “服务” 的类都遵守同一个名为 “服务接口” 的协议， 然后代理想要把它的一些方法交给服务去做，进而代理只是持有服务的一个引用，然后在需要解决问题的时候，调用代理来解决。</p><p><img loading=lazy src=../imgs/proxy.png alt=proxy></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#75715e>// Service Interface</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>Work</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>manageStuff</span>()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>dispatchSalary</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Proxy</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Boss</span>: Work {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> manager: Manager?
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(manager: Manager) {
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>manageStuff</span>() {
</span></span><span style=display:flex><span>            manager?.manageStuff()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>dispatchSalary</span>() {
</span></span><span style=display:flex><span>            manager?.dispatchSalary()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Service</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Manager</span>: Work {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>manageStuff</span>() {
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>dispatchSalary</span>() {
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> manager = Manager()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> boss = Boss(manager: manager)
</span></span><span style=display:flex><span>    boss.dispatchSalary()   <span style=color:#75715e>// In fact, it&#39;s the manager whom dispatch the salary.</span>
</span></span></code></pre></div><h3 id=delegate>Delegate<a hidden class=anchor aria-hidden=true href=#delegate>#</a></h3><p>We move some detail method from class A to class B (delegation), and the B can do some detail by the inputed A’s reference.</p><p>我们 A 中实现具体功能的方法移动到 B 中，B 为受委托对象，B 中的方法都是需要输入一个 A 的引用，从而才能让 B 替 A 做一些具体且复杂的操作。相当于 A 把复杂的操作委派给 B 来完成。</p><p>Class <code>Game</code> has a <code>GameDelegation</code> in it. Then input the <code>Game</code> instance to the <code>Delegation</code> instance, and the delegation can do some detailed work that may be previously done by the <code>Game</code> instance. So it‘s called delegate model.</p><p>类 <code>game</code> 拥有一个 <code>GameDelegation</code> . 接着输入 <code>Game</code> 实例到 <code>Delegation</code> 的实例，这个委派者可以做一些本来应该由 <code>Game</code> 的实例来完成的细节的事情。这样的模式称为委派模式。</p><p><img loading=lazy src=../imgs/delegation.png alt=delegate></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#75715e>// Delegation</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>Delegation</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>gameDidStart</span>(<span style=color:#66d9ef>_</span> game: Game)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>game</span>(<span style=color:#66d9ef>_</span> game: Game)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>gameDidEnd</span>(<span style=color:#66d9ef>_</span> game: Game)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Game</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>Game</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> delegation: Delegation? { <span style=color:#66d9ef>get</span> <span style=color:#66d9ef>set</span> }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>play</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete Deleagtion</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SnakeTracker</span>: Delegation {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>gameDidStart</span>(<span style=color:#66d9ef>_</span> game: Game) {
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>game</span>(<span style=color:#66d9ef>_</span> game: Game) {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// do something</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>gameDidEnd</span>(<span style=color:#66d9ef>_</span> game: Game) {
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete Game</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SnakeGame</span>: Game {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> delegation: Delegation?
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(<span style=color:#66d9ef>_</span> delegation: Delegation) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.delegation = delegation
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>play</span>() {
</span></span><span style=display:flex><span>            delegation!.gameDidStart(<span style=color:#66d9ef>self</span>)
</span></span><span style=display:flex><span>            delegation!.game(<span style=color:#66d9ef>self</span>)
</span></span><span style=display:flex><span>            delegation!.gameDidEnd(<span style=color:#66d9ef>self</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> gameTracker = SnakeTracker()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> game = SnakeGame(gameTracker)
</span></span><span style=display:flex><span>    game.play()  <span style=color:#75715e>// It&#39;s the func of the game, but the detail work is done by the delegation.</span>
</span></span></code></pre></div><h2 id=behavioral>Behavioral<a hidden class=anchor aria-hidden=true href=#behavioral>#</a></h2><h3 id=chain-of-responsibility>Chain of Responsibility<a hidden class=anchor aria-hidden=true href=#chain-of-responsibility>#</a></h3><p>We set a chain of responsibility. Then it t allow the solver solve the request or sends the request to the next another solver. As the diagram shown below, the handler is one solver of the chain.</p><p>我们设定了一条责任链，然后它允许处理者选择处理请求或者将请求发送给下一个其它的处理者。下图中，handler 是责任链上的一个处理者。</p><p><img loading=lazy src=../imgs/chainOfResponsibility.png alt="chain of responsibility"></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#75715e>// Problem wait to be solve</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Request</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> priority: Int
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> s: String
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(p: Int, s: String) {
</span></span><span style=display:flex><span>            priority = p
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.s = s
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Handler</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>Thought</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>solve</span>(r: Request)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Base handler</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>People</span>: Thought {
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> next: People?
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>setNext</span>(next: People) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.next = next
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>solve</span>(r: Request) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> n = next {
</span></span><span style=display:flex><span>                n.solve(r: r)
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>&#34;No people want to solve&#34;</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete handler</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Guard</span>: People {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>solve</span>(r: Request) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> r.priority <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>2</span> {
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>&#34;Just be sovled by Guard [</span><span style=color:#e6db74>\(</span>r.s<span style=color:#e6db74>)</span><span style=color:#e6db74>]&#34;</span>)
</span></span><span style=display:flex><span>                print(r.s)
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>super</span>.solve(r: r)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete handler</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Commander</span>: People {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>solve</span>(r: Request) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> r.priority <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>4</span> {
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>&#34;Commander solve [</span><span style=color:#e6db74>\(</span>r.s<span style=color:#e6db74>)</span><span style=color:#e6db74>]&#34;</span>)
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>super</span>.solve(r: r)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete handler</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Leader</span>: People {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>solve</span>(r: Request) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> r.priority <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>10</span> {
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>&#34;Leader come and solve [</span><span style=color:#e6db74>\(</span>r.s<span style=color:#e6db74>)</span><span style=color:#e6db74>]&#34;</span>)
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>super</span>.solve(r: r)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> g = Guard()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> c = Commander()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> l = Leader()
</span></span><span style=display:flex><span>    g.setNext(next: c)
</span></span><span style=display:flex><span>    c.setNext(next: l)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> r = Request(p: <span style=color:#ae81ff>9</span>, s: <span style=color:#e6db74>&#34;Let us in&#34;</span>)
</span></span><span style=display:flex><span>    g.solve(r: r)
</span></span></code></pre></div><h3 id=command>Command<a hidden class=anchor aria-hidden=true href=#command>#</a></h3><p>Create receiver, then create command and link it to the receiver if needed, then create sender and link it to the specific command. The command mode extract the command from the business, and set a sender and receiver. The sender send message to receiver by calling the command, but not call the receiver directly.</p><p>创建接收者，然后创建命令并且在有需要的时候把它连接到接收者，然后创建发送者并且把它连接到命令。命令模式从业务中抽出命令的部分，然后设置一个发送者和接收者。发送者通过调用命令向接受者发送信息，而不是直接调用接收者。</p><p><img loading=lazy src=../imgs/command.png alt=command></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#75715e>// Message</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TableInfo</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> tableNo: Int?
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(tableNo: Int) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.tableNo = tableNo
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Receiver</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Cooker</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>cookMeal</span>(info: TableInfo) {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Cook meal for: </span><span style=color:#e6db74>\(</span>info.tableNo!<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>sayHello</span>(info: TableInfo) {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Say hello to: </span><span style=color:#e6db74>\(</span>info.tableNo!<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>reheatFood</span>(info: TableInfo) {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Reheat food for: </span><span style=color:#e6db74>\(</span>info.tableNo!<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Command</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>Command</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>execute</span>(info: TableInfo)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete Command</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ServeCommand</span>: Command {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> cooker: Cooker?
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(cooker: Cooker) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.cooker = cooker
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>execute</span>(info: TableInfo) {
</span></span><span style=display:flex><span>            cooker?.sayHello(info: info)
</span></span><span style=display:flex><span>            cooker?.cookMeal(info: info)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Sender</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Waiter</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> command: Command
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(command: Command) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.command = command
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>executeCommand</span>(info: TableInfo) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.command.execute(info: info)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> cooker = Cooker()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> command = ServeCommand(cooker: cooker)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> waiter = Waiter(command: command)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    waiter.executeCommand(info: TableInfo(tableNo: <span style=color:#ae81ff>4</span>))
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Print:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Say hello to: 4</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Cook meal for: 4</span>
</span></span></code></pre></div><h3 id=iterator>Iterator<a hidden class=anchor aria-hidden=true href=#iterator>#</a></h3><p>The idea of the iterator is to extract the traversal behavior into an independent iterator object. The collection has some elements, and we use the iterator to get each element step by step.</p><p>迭代器的主要思想是将遍历行为抽取为单独的迭代器对象。</p><p><img loading=lazy src=../imgs/iterator.png alt=iterator></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#75715e>// Element in the collection</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Node</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> info: String = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(<span style=color:#66d9ef>_</span> s: String) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.info = s
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Iterator</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>Iterator</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>hasNext</span>() -&gt; Bool
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getNext</span>() -&gt; Node
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete iterator</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PositiveIterator</span>: Iterator {
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> collection: Collection
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> curIndex = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(<span style=color:#66d9ef>_</span> c: Collection) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.collection = c
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>hasNext</span>() -&gt; Bool {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> curIndex <span style=color:#f92672>&lt;</span> collection.nodes.count {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span>  <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getNext</span>() -&gt; Node {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> node = collection.nodes[curIndex]
</span></span><span style=display:flex><span>            curIndex <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> node
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete iterator</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RevertIerator</span>: Iterator {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> collection: Collection
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> curIndex = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(<span style=color:#66d9ef>_</span> c: Collection) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.collection = c
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.curIndex = collection.nodes.count <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>hasNext</span>() -&gt; Bool {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> curIndex <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span>{
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span>  <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getNext</span>() -&gt; Node {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> node = collection.nodes[curIndex]
</span></span><span style=display:flex><span>            curIndex <span style=color:#f92672>-=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> node
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Collection</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>Collection</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> nodes: [Node] { <span style=color:#66d9ef>get</span> <span style=color:#66d9ef>set</span> }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getIterator</span>() -&gt; Iterator
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getRevertIterator</span>() -&gt; Iterator
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete collecton</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NodesCollection</span>: Collection {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> nodes: [Node]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.nodes = []
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>append</span>(<span style=color:#66d9ef>_</span> n: Node) {
</span></span><span style=display:flex><span>            nodes.append(n)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getIterator</span>() -&gt; Iterator {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> PositiveIterator(<span style=color:#66d9ef>self</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getRevertIterator</span>() -&gt; Iterator {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> RevertIerator(<span style=color:#66d9ef>self</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> str = <span style=color:#e6db74>&#34;hello world&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> collection = NodesCollection()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> s <span style=color:#66d9ef>in</span> str {
</span></span><span style=display:flex><span>        collection.append(Node(String(s)))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> it = collection.getIterator()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> (it.hasNext()) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> n = it.getNext()
</span></span><span style=display:flex><span>        print(n.info, terminator: <span style=color:#e6db74>&#34; &#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    print()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    it = collection.getRevertIterator()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> (it.hasNext()) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> n = it.getNext()
</span></span><span style=display:flex><span>        print(n.info, terminator: <span style=color:#e6db74>&#34;_&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><h3 id=mediator>Mediator<a hidden class=anchor aria-hidden=true href=#mediator>#</a></h3><p>The mediator constrains the interaction between the component, the components can only notify the mediator and the mediator can manage the action of all the components it contains.</p><p>中介者限制了组件之间的交互，组件只能通知中介一些指令，然后中介者管理它内部拥有的所有组件的数据操作与行为。</p><p><img loading=lazy src=../imgs/mediator.png alt=mediator></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#75715e>// Component basic class</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Component</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> m: Mediator
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(mediator: Mediator) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.m = mediator
</span></span><span style=display:flex><span>            m.notify(component: <span style=color:#66d9ef>self</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete component</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Button</span>: Component {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>click</span>() {
</span></span><span style=display:flex><span>            m.notify(component: <span style=color:#66d9ef>self</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete component</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CheckBox</span>: Component {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> check = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>isCheck</span>() -&gt; Bool {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> check
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete component</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PasswordText</span>: Component {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> text: String = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getText</span>() -&gt; String{
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> text
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete component</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserNameText</span>: Component {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> text: String = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getText</span>() -&gt; String{
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> text
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>Mediator</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>notify</span>(component: Component)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete mediator</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LoginMediator</span>: Mediator {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> btnLogin: Button?
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> tickSavePassword: CheckBox?
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> password: PasswordText?
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> userName: UserNameText?
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>notify</span>(component: Component) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> component <span style=color:#66d9ef>is</span> Button {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> btn = component <span style=color:#66d9ef>as</span>! Button
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>self</span>.btnLogin == <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// self btn initialize</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>self</span>.btnLogin = btn
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> 
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (canLogin(userName: userName?.getText(), password: password?.getText())) {
</span></span><span style=display:flex><span>                    print(<span style=color:#e6db74>&#34;Login success&#34;</span>)
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> wantSave = tickSavePassword?.isCheck() {
</span></span><span style=display:flex><span>                        <span style=color:#75715e>// save the userName and password</span>
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                    print(<span style=color:#e6db74>&#34;Login failed&#34;</span>)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> component <span style=color:#66d9ef>is</span> CheckBox {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> box = component <span style=color:#66d9ef>as</span>! CheckBox
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>self</span>.tickSavePassword = box
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> component <span style=color:#66d9ef>is</span> UserNameText {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> userName = component <span style=color:#66d9ef>as</span>! UserNameText
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>self</span>.userName = userName
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> component <span style=color:#66d9ef>is</span> PasswordText {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> password = component <span style=color:#66d9ef>as</span>! PasswordText 
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>self</span>.password = password
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// The function check whether the username and password match</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>canLogin</span>(userName: String?, password: String?) -&gt; Bool {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> userName == <span style=color:#66d9ef>nil</span> <span style=color:#f92672>||</span> password == <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> name = userName, <span style=color:#66d9ef>let</span> word = password{
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> name == <span style=color:#e6db74>&#34;hello&#34;</span> <span style=color:#f92672>&amp;&amp;</span> word == <span style=color:#e6db74>&#34;Mike&#34;</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        } 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> mediator = LoginMediator()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> userName = UserNameText(mediator: mediator)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> password = PasswordText(mediator: mediator)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> tickSavePassword = CheckBox(mediator: mediator)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> btnLogin = Button(mediator: mediator)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    userName.text = <span style=color:#e6db74>&#34;hello&#34;</span>
</span></span><span style=display:flex><span>    password.text = <span style=color:#e6db74>&#34;Mike&#34;</span>
</span></span><span style=display:flex><span>    tickSavePassword.check = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    btnLogin.click()
</span></span></code></pre></div><h3 id=memento>Memento<a hidden class=anchor aria-hidden=true href=#memento>#</a></h3><p>It allow to save or recover the object state before without expose the object’s implemented detail. The originator can create the snapshot of itself and can restore the snapshot when it need. The memento is a value object of the originator’s snapshot state, it’s built by the initializer and pass the information by only one time. The caretaker can only use the originator’s <code>makeMemento()</code> and <code>restore()</code>.</p><p>它允许在不暴露对象实现细节的情况下，保存和恢复对象之前的状态。原发器可以创建它自己的快照并且在需要的时候恢复快照到自身。备忘录是一个用于存放原发器快照状态的值对象，它只通过构造函数传递状态信息。负责人只可以使用原发器的 “创建快照” 和 “恢复状态” 的方法。</p><p><img loading=lazy src=../imgs/memento.png alt=memento></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#75715e>// Originator</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>Animal</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getMemento</span>() -&gt; Memento
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Memento</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>Memento</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>restore</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete originator</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Dog</span>: Animal {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> age: Int
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> weight: Float
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> legCount: Int
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(age: Int, weight: Float, legCount: Int) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.age = age
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.weight = weight
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.legCount = legCount
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getMemento</span>() -&gt; Memento {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> DogData(dog: <span style=color:#66d9ef>self</span>, age: age, weight: weight, legCount: legCount)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>setAge</span>(age: Int) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.age = age
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>setWeight</span>(weight: Float) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.weight = weight
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>setLegCount</span>(legCount: Int) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.legCount = legCount
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>info</span>() -&gt; String {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;age: </span><span style=color:#e6db74>\(</span>age<span style=color:#e6db74>)</span><span style=color:#e6db74> weight: </span><span style=color:#e6db74>\(</span>weight<span style=color:#e6db74>)</span><span style=color:#e6db74> legCount: </span><span style=color:#e6db74>\(</span>legCount<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete memento</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DogData</span>: Memento {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> age: Int
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> weight: Float
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> legCount: Int
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> dog: Dog?
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(dog: Dog, age: Int, weight: Float, legCount: Int) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.dog = dog
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.age = age
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.weight = weight
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.legCount = legCount
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>restore</span>() {
</span></span><span style=display:flex><span>            dog?.setAge(age: age)
</span></span><span style=display:flex><span>            dog?.setWeight(weight: weight)
</span></span><span style=display:flex><span>            dog?.setLegCount(legCount: legCount)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// CareTaker</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Recored</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> dog: Dog
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> history: [Memento] = []
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(dog: Dog) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.dog = dog
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>save</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> backup = dog.getMemento()
</span></span><span style=display:flex><span>            history.append(backup)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (history.count <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>10</span>) {
</span></span><span style=display:flex><span>                history.remove(at: <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>undo</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> history.count <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> 
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> data = history[history.count <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>            data.restore()
</span></span><span style=display:flex><span>            history.remove(at: history.count <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> dog = Dog(age: <span style=color:#ae81ff>2</span>, weight: <span style=color:#ae81ff>15</span>, legCount: <span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> record = Recored(dog: dog)
</span></span><span style=display:flex><span>    record.save()
</span></span><span style=display:flex><span>    print(dog.info())
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    dog.setAge(age: <span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>    dog.setWeight(weight: <span style=color:#ae81ff>20</span>)
</span></span><span style=display:flex><span>    print(dog.info())
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    record.undo()
</span></span><span style=display:flex><span>    print(dog.info())
</span></span></code></pre></div><h3 id=observer>Observer<a hidden class=anchor aria-hidden=true href=#observer>#</a></h3><p>The publisher has some subscribers reference, it can add subscriber, remove subscriber, and notify all subscriber.</p><p>发布者持有一些订阅者的引用，它可以添加订阅者，也可以移除订阅者，或者是通知所有的订阅者。</p><p><img loading=lazy src=../imgs/observer.png alt=observer></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Message</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> text: String = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(<span style=color:#66d9ef>_</span> m: String) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.text = m
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Event</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> text: String = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(<span style=color:#66d9ef>_</span> e: String) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.text = e
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Subscriber</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>Listener</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>update</span>(message: Message)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Publisher</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>Publisher</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>subscribe</span>(event: Event, listener: Listener)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>remove</span>(event: Event)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>notify</span>(event: Event, message: Message)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>notifyAll</span>(message: Message)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete listener</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ListenerA</span>: Listener {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>update</span>(message: Message) {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;A do: </span><span style=color:#e6db74>\(</span>message.text<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete listener</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ListenerB</span>: Listener {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>update</span>(message: Message) {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;B do: </span><span style=color:#e6db74>\(</span>message.text<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete publisher</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ViewPublisher</span>: Publisher {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> listeners: [String: Listener] = [:]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>subscribe</span>(event: Event, listener: Listener) {
</span></span><span style=display:flex><span>            listeners[event.text] = listener
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>remove</span>(event: Event) {
</span></span><span style=display:flex><span>            listeners.removeValue(forKey: event.text)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>notify</span>(event: Event, message: Message) {
</span></span><span style=display:flex><span>            listeners[event.text]?.update(message: message)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>notifyAll</span>(message: Message) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> item <span style=color:#66d9ef>in</span> listeners.values {
</span></span><span style=display:flex><span>                item.update(message: message)
</span></span><span style=display:flex><span>            }  
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>     
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> publisher = ViewPublisher()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> a = ListenerA()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> b = ListenerB()
</span></span><span style=display:flex><span>    publisher.subscribe(event: Event(<span style=color:#e6db74>&#34;look&#34;</span>), listener: a)
</span></span><span style=display:flex><span>    publisher.subscribe(event: Event(<span style=color:#e6db74>&#34;find&#34;</span>), listener: b)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    publisher.notify(event: Event(<span style=color:#e6db74>&#34;look&#34;</span>), message: Message(<span style=color:#e6db74>&#34;Firstly, welcome.&#34;</span>))
</span></span><span style=display:flex><span>    print()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    publisher.notifyAll(message: Message(<span style=color:#e6db74>&#34;Hello world!&#34;</span>))
</span></span><span style=display:flex><span>    print()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    publisher.remove(event: Event(<span style=color:#e6db74>&#34;look&#34;</span>))
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    publisher.notifyAll(message: Message(<span style=color:#e6db74>&#34;The end.&#34;</span>))
</span></span></code></pre></div><h3 id=state>State<a hidden class=anchor aria-hidden=true href=#state>#</a></h3><p>The state mode enable the class to change its behavior when its inner state changed. The <code>StateContext</code> only do the switch work, and the detail work is done by <code>State</code> object. The context manage the statements in a high level, it can switch some different state when we need. The context inject a reference to the concrete state object to enable the state to delegate the detail work.
状态模式中，当类的状态改变时，类的行为随着改变。状态上下文类只执行状态切换工作，具体的工作细节交给状态对象去执行。上下文对象在一个较高的层次管理着自身的状态，它可以在我们有需要的时候切换不同的状态。上下文对象注入了一个自己的引用给状态对象，使得状态对象可以代理在切换状态时候的细节工作。</p><p><img loading=lazy src=../imgs/state.png alt=state></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#75715e>// Abstract state</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>State</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> context: Context?
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> name: String = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(context: Context?) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.context = context
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete state</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NewState</span>: State {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>init</span>(context: Context?) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span>.<span style=color:#66d9ef>init</span>(context: context)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.name = <span style=color:#e6db74>&#34;New&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>start</span>() {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Call start&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>self</span>.name == <span style=color:#e6db74>&#34;New&#34;</span> {
</span></span><span style=display:flex><span>                context?.setState(state: RunnableState(context: context))
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>&#34;Can&#39;t go to runnable&#34;</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete state</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RunnableState</span>: State {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>init</span>(context: Context?) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span>.<span style=color:#66d9ef>init</span>(context: context)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.name = <span style=color:#e6db74>&#34;Runnable&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getCpu</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>self</span>.name == <span style=color:#e6db74>&#34;Runnable&#34;</span> {
</span></span><span style=display:flex><span>                context?.setState(state: RunningState(context: context))
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>&#34;Can&#39;t go to running&#34;</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete state</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RunningState</span>: State {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>init</span>(context: Context?) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span>.<span style=color:#66d9ef>init</span>(context: context)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.name = <span style=color:#e6db74>&#34;Running&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>suspend</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>self</span>.name == <span style=color:#e6db74>&#34;Running&#34;</span> {
</span></span><span style=display:flex><span>                context?.setState(state: BlockState(context: context))
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>stop</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>self</span>.name == <span style=color:#e6db74>&#34;Running&#34;</span> {
</span></span><span style=display:flex><span>                context?.setState(state: DeadState(context: context))
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete state</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span>  <span style=color:#a6e22e>BlockState</span>: State {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>init</span>(context: Context?) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span>.<span style=color:#66d9ef>init</span>(context: context)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.name = <span style=color:#e6db74>&#34;Block&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>resume</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> name == <span style=color:#e6db74>&#34;Block&#34;</span> {
</span></span><span style=display:flex><span>                context?.setState(state: RunnableState(context: context))
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete state</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DeadState</span>: State {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>init</span>(context: Context?) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span>.<span style=color:#66d9ef>init</span>(context: context)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.name = <span style=color:#e6db74>&#34;Dead&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Thread Context</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Context</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> state: State?
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.state = NewState(context: <span style=color:#66d9ef>self</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>setState</span>(state: State) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.state = state
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getState</span>() -&gt; State? {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>self</span>.state
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>start</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> s = <span style=color:#66d9ef>self</span>.state <span style=color:#66d9ef>as</span>? NewState {
</span></span><span style=display:flex><span>                s.start()
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>suspend</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> s = <span style=color:#66d9ef>self</span>.state <span style=color:#66d9ef>as</span>?  RunningState {
</span></span><span style=display:flex><span>                s.suspend()
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>resume</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> s = <span style=color:#66d9ef>self</span>.state <span style=color:#66d9ef>as</span>? BlockState {
</span></span><span style=display:flex><span>                s.resume()
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getCpu</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> s = <span style=color:#66d9ef>self</span>.state <span style=color:#66d9ef>as</span>? RunnableState {
</span></span><span style=display:flex><span>                s.getCpu()  <span style=color:#75715e>// It will switch to the running state.</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span>  <span style=color:#a6e22e>stop</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> s = <span style=color:#66d9ef>self</span>.state <span style=color:#66d9ef>as</span>? RunningState {
</span></span><span style=display:flex><span>                s.stop()
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> context = Context()
</span></span><span style=display:flex><span>    context.start()   <span style=color:#75715e>// It will be runnable then.</span>
</span></span><span style=display:flex><span>    context.getCpu()  <span style=color:#75715e>// It will be running then.</span>
</span></span><span style=display:flex><span>    context.suspend() <span style=color:#75715e>// It will be blocked then.</span>
</span></span><span style=display:flex><span>    context.resume()  <span style=color:#75715e>// It will be runnable then.</span>
</span></span><span style=display:flex><span>    context.getCpu()  <span style=color:#75715e>// It will be running then.</span>
</span></span><span style=display:flex><span>    context.stop()    <span style=color:#75715e>// It will be dead then.</span>
</span></span></code></pre></div><h3 id=strategy>Strategy<a hidden class=anchor aria-hidden=true href=#strategy>#</a></h3><p>Strategy mode set some solution class, and each solution can be substituted by other solution easily. When we face different problem, we choose different solution to solve problem. The <code>Problem</code> class hold a reference of <code>Strategy</code> interface to use different strategy.
策略模式设定了一些算法类，每个算法类可以被其它算法类所替换。当我们面对不同的问题时，我们选择不同的策略来解决问题。“问题” 类持有 “策略”接口， 以便使用不同的策略。</p><p><img loading=lazy src=../imgs/strategy.png alt=strategy></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>Strategy</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>sort</span>(<span style=color:#66d9ef>_</span> nums: <span style=color:#66d9ef>inout</span> [Int]) -&gt; [Int]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Strategy A</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SelectedSort</span>: Strategy {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>sort</span>(<span style=color:#66d9ef>_</span> nums: <span style=color:#66d9ef>inout</span> [Int]) -&gt; [Int] {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Selected sort&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> len = nums.count
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> len <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>1</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> nums
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> i <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0.</span>.&lt;len {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> minIndex = i
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> j <span style=color:#66d9ef>in</span> (i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>)..&lt;len {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> nums[j] <span style=color:#f92672>&lt;</span> nums[minIndex] {
</span></span><span style=display:flex><span>                        minIndex = j
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> tmp = nums[i]
</span></span><span style=display:flex><span>                nums[i] = nums[minIndex]
</span></span><span style=display:flex><span>                nums[minIndex] = tmp
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> nums
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Strategy B</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>InsertSort</span>: Strategy {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>sort</span>(<span style=color:#66d9ef>_</span> nums: <span style=color:#66d9ef>inout</span> [Int]) -&gt; [Int] {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Insert sort&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> len = nums.count
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> len <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>1</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> nums
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> i <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>1.</span>.&lt;len {   
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> left = i <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>true</span> {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>left</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>||</span> nums[i] <span style=color:#f92672>&gt;</span> nums[<span style=color:#66d9ef>left</span>] {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>var</span> cover = i <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>var</span> t = nums[i]
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>while</span> cover <span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>left</span> {
</span></span><span style=display:flex><span>                            nums[cover <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>] = nums[cover] 
</span></span><span style=display:flex><span>                            cover <span style=color:#f92672>-=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                        } 
</span></span><span style=display:flex><span>                        nums[<span style=color:#66d9ef>left</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>] = t
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>                    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>left</span> <span style=color:#f92672>-=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> nums
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Problem</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> strategy: Strategy
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(strategy: Strategy) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.strategy = strategy
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>solve</span>(<span style=color:#66d9ef>_</span> nums: <span style=color:#66d9ef>inout</span> [Int]) -&gt; [Int] {
</span></span><span style=display:flex><span>            strategy.sort(&amp;nums)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>changeStrategy</span>(strategy: Strategy) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.strategy = strategy
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> nums = [<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>3</span>]
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> a = SelectedSort()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> b = InsertSort()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> problem = Problem(strategy: a)
</span></span><span style=display:flex><span>    problem.solve(&amp;nums)
</span></span><span style=display:flex><span>    print(nums)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    nums.shuffle()
</span></span><span style=display:flex><span>    print(nums)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    problem.changeStrategy(strategy: b)
</span></span><span style=display:flex><span>    problem.solve(&amp;nums)
</span></span><span style=display:flex><span>    print(nums)
</span></span></code></pre></div><h3 id=template-method>Template Method<a hidden class=anchor aria-hidden=true href=#template-method>#</a></h3><p>The super class define an algorithm structure, and the subclass can override the method without changing the structure. Depart an algorithm into a series of step, and rewrite these step as method, then call these method in the template method.</p><p>超类定义了一个算法框架，子类可以在不改动框架的情况下依据需要来重写方法。把算法拆分为一系列的步骤，把这些步骤写成方法，然后可以在模板方法中调用这些方法。</p><p><img loading=lazy src=../imgs/templateMethod.png alt=templateMethod></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#75715e>// Abstract class</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>House</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Use final to prevent the subclass override the template method.</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>build</span>(){
</span></span><span style=display:flex><span>            makeRoot()
</span></span><span style=display:flex><span>            makeWall()
</span></span><span style=display:flex><span>            makeWindows()
</span></span><span style=display:flex><span>            makeRoof()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>makeRoot</span>() {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Use cement to construct root.&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>makeWall</span>() {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Add white wall&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>makeWindows</span>() {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Add window&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>makeRoof</span>() {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Add smooth roof&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete class A</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EastenHouse</span>: House {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>makeWall</span>() {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Add red wall.&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>makeWindows</span>() {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Add wooden windows.&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>makeRoof</span>() {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Add wooden roof.&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Concrete class B</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WestenHouse</span>: House {
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>makeWindows</span>() {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Add iron windows&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>makeRoof</span>() {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Add cement roof&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> house = EastenHouse()
</span></span><span style=display:flex><span>    house.build()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> houseB = WestenHouse()
</span></span><span style=display:flex><span>    houseB.build()
</span></span></code></pre></div><h3 id=visitor>Visitor<a hidden class=anchor aria-hidden=true href=#visitor>#</a></h3><p>Visitor mode can isolate the algorithm and the object which algorithm affect. (Depart the server and the visitor). It put the new behaviors into a <code>Visitor</code> class, then pass the existed object’s reference to the visitor to do the behaviors. It just visit the data of the object, but not change the original data.</p><p>访问者模式可以隔离算法和被这个算法影响的对象（分离服务者和访问者）。它将新的行为放置在一个称为 “访问者” 的对象中，然后传递原有对象的引用来执行一些行为。它只是访问对象数据，而没有改变源数据。</p><p><img loading=lazy src=../imgs/vistor.png alt=vistor></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>Visitor</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>visit</span>(d: Dog)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>visit</span>(c: Cat)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>visit</span>(h: Horse)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>Element</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>accept</span>(v: Visitor)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Element A</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Dog</span>: Element {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> name = <span style=color:#e6db74>&#34;dog&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> age = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>accept</span>(v: Visitor) {
</span></span><span style=display:flex><span>            v.visit(d: <span style=color:#66d9ef>self</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Element B</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Cat</span>: Element {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> name = <span style=color:#e6db74>&#34;cat&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> age = <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>accept</span>(v: Visitor) {
</span></span><span style=display:flex><span>            v.visit(c: <span style=color:#66d9ef>self</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Element C</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Horse</span>: Element {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> name = <span style=color:#e6db74>&#34;horse&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> age = <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>accept</span>(v: Visitor) {
</span></span><span style=display:flex><span>            v.visit(h: <span style=color:#66d9ef>self</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Visitor 1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NameVisitor</span>: Visitor {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>visit</span>(d: Dog) {
</span></span><span style=display:flex><span>            print(d.name)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>visit</span>(c: Cat) {
</span></span><span style=display:flex><span>            print(c.name)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>visit</span>(h: Horse) {
</span></span><span style=display:flex><span>            print(h.name)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Visitor 2</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AgeVisitor</span>: Visitor {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>visit</span>(d: Dog) {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Dog age: </span><span style=color:#e6db74>\(</span>d.age<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>visit</span>(c: Cat) {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Cat age: </span><span style=color:#e6db74>\(</span>c.age<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>visit</span>(h: Horse) {
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Horse age: </span><span style=color:#e6db74>\(</span>h.age<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> dog = Dog()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> cat = Cat()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> horse = Horse()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> nameVisitor = NameVisitor()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> ageVisitor = AgeVisitor()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    dog.accept(v: nameVisitor)
</span></span><span style=display:flex><span>    cat.accept(v: nameVisitor)
</span></span><span style=display:flex><span>    horse.accept(v: nameVisitor)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    dog.accept(v: ageVisitor)
</span></span><span style=display:flex><span>    cat.accept(v: ageVisitor)
</span></span><span style=display:flex><span>    horse.accept(v: ageVisitor)
</span></span></code></pre></div><h2 id=模式的特征与区别>模式的特征与区别<a hidden class=anchor aria-hidden=true href=#模式的特征与区别>#</a></h2><h3 id=结构型>结构型<a hidden class=anchor aria-hidden=true href=#结构型>#</a></h3><ul><li>适配器模式的目的是为了让类 A 去模仿类 B，从而在需要类 B 的地方可以直接使用类 A 替代，适配器C既具有 B 的属性，又看起来像是 B （因为适配器继承自类 B）</li><li>桥接模式是具体的类 A 中具有抽象接口 B，构造 A 的时候注入一个 B 的实体对象，那么可以在使用对象 A 的时候，可以<strong>调用接口 B</strong> 来实现对应功能，这样的类 A 是依赖于接口而不是具体的类。</li><li>桥接模式是两个类 A 与 B 之间，使用一个接口，由 B 实现， 注入 A。</li><li>组合模式是组件模块与容器（抽象接口）都实现同一接口，容器里面可以持有多个接口实例（由组件模块实例来注入），形成树状结构。</li><li>装饰器模式是组件与装饰器（抽象接口）都实现同一接口，装饰器里面持有一个接口实例（由组件模块实例来注入）， 装饰器对持有的实例添加附带功能。</li><li>委托模式（delegate）是让一个对象扮演另外一个对象的行为。委托对象暂时持有到另外对象的引用。在适当时间发消息给另外对象。</li><li>代理模式（proxy）比委托更为严格，若干对象实现同一接口。</li></ul><h3 id=行为型>行为型<a hidden class=anchor aria-hidden=true href=#行为型>#</a></h3><ul><li><p>责任链模式（chain of responsibility）模式中的每一个对象持有指向另一对象的引用 A（用于转移责任），询问当前对象，当前对象若有能力处理事务则处理，若没有能力处理事务则把事务移交给另外一个对象（引用 A 所指）处理。</p></li><li><p>命令模式（command) 发送者和接收者使用命令进行间接沟通，常用于视图和控制器的分离（视图为发送者，控制器为接收者）。若与责任链结合，则为命令在传递给接收者的时候，是传递到接收者链上，从而寻求潜在的接收者。</p></li><li><p>中介者模式（mediator）设置一个中介者来管理那些来自组件的调用，中介者拥有各个组件的引用，站在更高的层次上对组件进行管理。组件之间通过中介者来发生交互，而不是组件之间进行耦合。</p></li><li><p>备忘录模式（memento），为原发器添加一个备忘录对象用于存放原发器的的状态信息，使用一个负责人对象来管理备忘录的增加与回滚，可以对原发器的版本进行控制。</p></li><li><p>观察者模式（observer），发布者持有多个订阅者的引用，当有需要发布新消息时，准确地向每个订阅者发送信息。</p><p>中介者和观察者很像，但是，中介者主要功能是消除一系列的组件之间的依赖，用于管理组件之间的调用，而观察者强调的是发布者向各个订阅的订阅者分发信息。</p></li><li><p>状态模式（状态模式）与策略模式（strategy）关键区别：</p><p>状态模式中的特定状态知道其它状态的存在，能从一个状态转移到另一状态。</p><p>策略模式中某个策略不知道其它策略的存在。</p></li><li><p>模版方法（template method) 中，超类定义了若干模板框架方法（固定的）和步骤方法，子类不能修改框架方法，只能重写步骤方法。模板方法中可以调用详细的步骤方法。工厂模式是模版方法的特殊形式。</p></li><li><p>访问者（visitor) 将操作交给其它的类（访问者类），允许访问者进行访问。它是命令模式的加强版本。访问者模式中，业务在需要使用访问服务的时候，传递自己的引用给访问者，而代理模式和委托模式是将自身引用注入到受托付到对象中，移交自己的权利。</p></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://1-1.link/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/>设计模式</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share 各种设计模式 on twitter" href="https://twitter.com/intent/tweet/?text=%e5%90%84%e7%a7%8d%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f&amp;url=https%3a%2f%2f1-1.link%2fpost%2fdesign-pattern%2fall-design-pattern%2f&amp;hashtags=%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 各种设计模式 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2f1-1.link%2fpost%2fdesign-pattern%2fall-design-pattern%2f&title=%e5%90%84%e7%a7%8d%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 各种设计模式 on telegram" href="https://telegram.me/share/url?text=%e5%90%84%e7%a7%8d%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f&amp;url=https%3a%2f%2f1-1.link%2fpost%2fdesign-pattern%2fall-design-pattern%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://1-1.link>CodePaper</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>