<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Error Handling | CodePaper</title><meta name=keywords content="编程语言"><meta name=description content="A class support for throwing, catching, propagating, and manipulating recoverable errors at runtime.
When an optional fails, it’s useful to understand what cause the failure, so that the code can respond accordingly.
Example: Reading a file from the disk may be fail in some way.
File not exist Have no permission to read. File not being encoded in a compatible format. Distinguishing among these different situations allows a program to resolve some errors and to communicate to the user any errors it can’t resolve."><meta name=author content><link rel=canonical href=https://1-1.link/post/language/swift/17error-handling/><link crossorigin=anonymous href=/assets/css/stylesheet.6e97a6b79be998515e8c86c68e32a9f7a90e6917f550d2af32568b717f5ca785.css integrity="sha256-bpemt5vpmFFejIbGjjKp96kOaRf1UNKvMlaLcX9cp4U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://1-1.link/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://1-1.link/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://1-1.link/favicon-32x32.png><link rel=apple-touch-icon href=https://1-1.link/apple-touch-icon.png><link rel=mask-icon href=https://1-1.link/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Error Handling"><meta property="og:description" content="A class support for throwing, catching, propagating, and manipulating recoverable errors at runtime.
When an optional fails, it’s useful to understand what cause the failure, so that the code can respond accordingly.
Example: Reading a file from the disk may be fail in some way.
File not exist Have no permission to read. File not being encoded in a compatible format. Distinguishing among these different situations allows a program to resolve some errors and to communicate to the user any errors it can’t resolve."><meta property="og:type" content="article"><meta property="og:url" content="https://1-1.link/post/language/swift/17error-handling/"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-05-07T16:00:40+08:00"><meta property="article:modified_time" content="2022-05-07T16:00:40+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Error Handling"><meta name=twitter:description content="A class support for throwing, catching, propagating, and manipulating recoverable errors at runtime.
When an optional fails, it’s useful to understand what cause the failure, so that the code can respond accordingly.
Example: Reading a file from the disk may be fail in some way.
File not exist Have no permission to read. File not being encoded in a compatible format. Distinguishing among these different situations allows a program to resolve some errors and to communicate to the user any errors it can’t resolve."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":3,"name":"Error Handling","item":"https://1-1.link/post/language/swift/17error-handling/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Error Handling","name":"Error Handling","description":"A class support for throwing, catching, propagating, and manipulating recoverable errors at runtime.\nWhen an optional fails, it’s useful to understand what cause the failure, so that the code can respond accordingly.\nExample: Reading a file from the disk may be fail in some way.\nFile not exist Have no permission to read. File not being encoded in a compatible format. Distinguishing among these different situations allows a program to resolve some errors and to communicate to the user any errors it can’t resolve.","keywords":["编程语言"],"articleBody":"A class support for throwing, catching, propagating, and manipulating recoverable errors at runtime.\nWhen an optional fails, it’s useful to understand what cause the failure, so that the code can respond accordingly.\nExample: Reading a file from the disk may be fail in some way.\nFile not exist Have no permission to read. File not being encoded in a compatible format. Distinguishing among these different situations allows a program to resolve some errors and to communicate to the user any errors it can’t resolve.\nRepresenting and Throwing Errors We can custom an error enumeration, and conform this enumeration to the Error protocol, so that the custom error can be use as a standard error.\n// Represent enum VendingMachineError: Error { case invaildSelection case insufficientFunds(coinsNeeded: Int) case outOfStack } struct Item { var price: Int var count: Int } class VendingMachine { var inventory = [ \"Cola\": Item(price: 3, count: 10), \"Cake\": Item(price: 12, count: 11), \"Chips\": Item(price: 8, count: 5) ] var coinsDeposited = 0 func vend(name: String) throws { guard let item = inventory[name] else { throw VendingMachineError.invaildSelection } guard item.price \u003c= coinsDeposited else { throw VendingMachineError.insufficientFunds(coinsNeeded: item.price - coinsDeposited) } guard item.count \u003e= 0 else { throw VendingMachineError.outOfStack } coinsDeposited -= item.price inventory[name]?.count -= 1 print(\"Dispensings \\(name)\") } } Testing the error throwing.\nvar machine = VendingMachine() do { machine.coinsDeposited = 15 try machine.vend(name: \"Cake\") print(\"Vend cake succeed\") // Current coinsDeposited is 6. try machine.vend(name: \"Chips\") print(\"Vend chips succeed\") } catch VendingMachineError.insufficientFunds, VendingMachineError.invaildSelection, VendingMachineError.outOfStack { print(\"Have an error\") } // Print: // Dispensings Cake // Vend cake succeed // Have an error The do{ try } will be interrupted if the some errors were thrown.\nHandling Errors Four way to handle error.\nPropagate the error to whom call the function.(Pass the error to higher level) Use do-catch statement. Handle the error as an optional value. (try?) Assert that the error will not occur. (try!) Swift doesn’t involve unwinding the call stack in which can be computationally expensive.\n1. Propagate Error Using Throwing let people = [\"Amy\": \"Cake\", \"Bob\": \"Chips\"] func buyFavoriteSnack(name: String) throws { try machine.vend(name: name) } 2. Using Do-Catch do { try something } catch parameter1 { } catch parameter2 where condition { } Example\ndo { try machine.vend(name: \"cola\") } catch is Error { // Catch all errors print(\"Transation fail.\") } do { try machine.vend(name: \"Cake\") } catch VendingMachineError.insufficientFunds { print(\"insufficientFunds\") } catch { // Catch other errors. } If none of the catch handle the error, the error propagates to the surrounding scope. And finally the error must be handled by the top-level scope, otherwise the error will triggers the runtime error.\nFinally handle the errors.\nfunc buySomething(name: String) throws{ do { try machine.vend(name: name) } catch VendingMachineError.outOfStack { print(\"Out of stack\") } } do { try buySomething(name: \"Cake\") } catch VendingMachineError.invaildSelection { print(\"insufficientFunds\") } catch { // Catch other errors. Otherwise the other errors will trigger runtime error. print(\"Other\") } // Print: Other Write in a better form.\nfunc buySomething(name: String) throws{ do { try machine.vend(name: name) } catch is VendingMachineError { print(\"Vending Maching have an error.\") } } 3. Converting Errors to Optional Values Use try? to convert errors to optional value.\nfunc remain(name: String) throws -\u003e Int { if let item = machine.inventory[name] { return item.count } else { throw VendingMachineError.invaildSelection } } var countOfCake = try? remain(name: \"Cake\") // Use the 'try?' to convert the error into a optional value. var count: Int? do { try count = remain(name: \"Cake\") } catch is Error { count = nil } print(countOfCake) // The countOfCake is equal to the count. They are all optional. 4. Assert the Error Not Occur try! return a normal type. If the method/init throws an error, it will crash. Because the returned type will be nil and a normal type cannot handle nil.\nDisabling Error Propagation\nUse the try! to disable error propagation and wrap the call in a runtime assertion\nfunc remain(name: String) throws -\u003e Int { if let item = machine.inventory[name] { return item.count } else { throw VendingMachineError.invaildSelection } } let c = try! remain(name: \"Cola\") let e = try! remain(name: \"Bread\") // It will raises a runtime error. Avoid using try! in most cases since it will break your program.\nSpecifying Cleanup Action Use a defer statement to execute a set of statements just before code leaves the current block of code.\nA defer statement defers execution until the current scope is exited, and it has a backward sequence to call the statements in the defer block.\nfunc processFile(name: String) throws{ if exists(name) { let file = open(name) defer { close(file) // Executed third doSomething() // Executed second stop() // Executed first } while let line = try file.readline() { } // Here call the stop, doSomething, close } } ","wordCount":"797","inLanguage":"en","datePublished":"2022-05-07T16:00:40+08:00","dateModified":"2022-05-07T16:00:40+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://1-1.link/post/language/swift/17error-handling/"},"publisher":{"@type":"Organization","name":"CodePaper","logo":{"@type":"ImageObject","url":"https://1-1.link/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://1-1.link accesskey=h title="CodePaper (Alt + H)">CodePaper</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://1-1.link/archive/ title=档案><span>档案</span></a></li><li><a href=https://1-1.link/categories/ title=类别><span>类别</span></a></li><li><a href=https://1-1.link/tags/ title=标签><span>标签</span></a></li><li><a href=https://1-1.link/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://1-1.link/about/ title=关于我><span>关于我</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://1-1.link>Home</a></div><h1 class=post-title>Error Handling</h1><div class=post-meta><span title='2022-05-07 16:00:40 +0800 +0800'>May 7, 2022</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#example aria-label=Example:>Example:</a></li><li><a href=#representing-and-throwing-errors aria-label="Representing and Throwing Errors">Representing and Throwing Errors</a></li><li><a href=#handling-errors aria-label="Handling Errors">Handling Errors</a><ul><li><a href=#1-propagate-error-using-throwing aria-label="1. Propagate Error Using Throwing">1. Propagate Error Using Throwing</a></li><li><a href=#2-using-do-catch aria-label="2. Using Do-Catch">2. Using Do-Catch</a></li><li><a href=#3-converting-errors-to-optional-values aria-label="3. Converting Errors to Optional Values">3. Converting Errors to Optional Values</a></li><li><a href=#4-assert-the-error-not-occur aria-label="4. Assert the Error Not Occur">4. Assert the Error Not Occur</a></li></ul></li><li><a href=#specifying-cleanup-action aria-label="Specifying Cleanup Action">Specifying Cleanup Action</a></li></ul></div></details></div><div class=post-content><p>A class support for throwing, catching, propagating, and manipulating recoverable errors at <em>runtime</em>.</p><p>When an optional fails, it’s useful to understand what cause the failure, so that the code can respond accordingly.</p><h2 id=example>Example:<a hidden class=anchor aria-hidden=true href=#example>#</a></h2><p>Reading a file from the disk may be fail in some way.</p><ul><li>File not exist</li><li>Have no permission to read.</li><li>File not being encoded in a compatible format.</li></ul><p>Distinguishing among these different situations allows a program to resolve some errors and to communicate to the user any errors it can’t resolve.</p><h2 id=representing-and-throwing-errors>Representing and Throwing Errors<a hidden class=anchor aria-hidden=true href=#representing-and-throwing-errors>#</a></h2><p>We can custom an error enumeration, and conform this enumeration to the <code>Error</code> protocol, so that the custom error can be use as a standard error.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#75715e>// Represent</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>VendingMachineError</span>: Error {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> invaildSelection
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> insufficientFunds(coinsNeeded: Int)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> outOfStack
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Item</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> price: Int
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> count: Int
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>VendingMachine</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> inventory = [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;Cola&#34;</span>: Item(price: <span style=color:#ae81ff>3</span>, count: <span style=color:#ae81ff>10</span>),
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;Cake&#34;</span>: Item(price: <span style=color:#ae81ff>12</span>, count: <span style=color:#ae81ff>11</span>),
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;Chips&#34;</span>: Item(price: <span style=color:#ae81ff>8</span>, count: <span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> coinsDeposited = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>vend</span>(name: String) <span style=color:#66d9ef>throws</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>guard</span> <span style=color:#66d9ef>let</span> item = inventory[name] <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> VendingMachineError.invaildSelection
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>guard</span> item.price <span style=color:#f92672>&lt;=</span> coinsDeposited <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> VendingMachineError.insufficientFunds(coinsNeeded: item.price <span style=color:#f92672>-</span> coinsDeposited)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>guard</span>  item.count <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> VendingMachineError.outOfStack
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        coinsDeposited <span style=color:#f92672>-=</span> item.price
</span></span><span style=display:flex><span>        inventory[name]?.count <span style=color:#f92672>-=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Dispensings </span><span style=color:#e6db74>\(</span>name<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Testing the error throwing.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>var</span> machine = VendingMachine()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span> {
</span></span><span style=display:flex><span>    machine.coinsDeposited = <span style=color:#ae81ff>15</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> machine.vend(name: <span style=color:#e6db74>&#34;Cake&#34;</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Vend cake succeed&#34;</span>)      <span style=color:#75715e>// Current coinsDeposited is 6.</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> machine.vend(name: <span style=color:#e6db74>&#34;Chips&#34;</span>) 
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Vend chips succeed&#34;</span>)
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>catch</span>  VendingMachineError.insufficientFunds, VendingMachineError.invaildSelection, VendingMachineError.outOfStack {
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Have an error&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Print:</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Dispensings Cake</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Vend cake succeed</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Have an error</span>
</span></span></code></pre></div><p>The <code>do{ try }</code> will be interrupted if the some errors were thrown.</p><h2 id=handling-errors>Handling Errors<a hidden class=anchor aria-hidden=true href=#handling-errors>#</a></h2><p>Four way to handle error.</p><ul><li>Propagate the error to whom call the function.(Pass the error to higher level)</li><li>Use <code>do-catch</code> statement.</li><li>Handle the error as an optional value. (<code>try?</code>)</li><li>Assert that the error will not occur. (<code>try!</code>)</li></ul><p>Swift doesn’t involve unwinding the call stack in which can be computationally expensive.</p><h3 id=1-propagate-error-using-throwing>1. Propagate Error Using Throwing<a hidden class=anchor aria-hidden=true href=#1-propagate-error-using-throwing>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>let</span> people = [<span style=color:#e6db74>&#34;Amy&#34;</span>: <span style=color:#e6db74>&#34;Cake&#34;</span>, <span style=color:#e6db74>&#34;Bob&#34;</span>: <span style=color:#e6db74>&#34;Chips&#34;</span>]
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>buyFavoriteSnack</span>(name: String) <span style=color:#66d9ef>throws</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> machine.vend(name: name)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-using-do-catch>2. Using Do-Catch<a hidden class=anchor aria-hidden=true href=#2-using-do-catch>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>do</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>try</span> something
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>catch</span> parameter1 {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>catch</span> parameter2 <span style=color:#66d9ef>where</span> condition {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Example</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> machine.vend(name: <span style=color:#e6db74>&#34;cola&#34;</span>)
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>catch</span> <span style=color:#66d9ef>is</span> Error {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Catch all errors</span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Transation fail.&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> machine.vend(name: <span style=color:#e6db74>&#34;Cake&#34;</span>)
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>catch</span> VendingMachineError.insufficientFunds {
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;insufficientFunds&#34;</span>)
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>catch</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Catch other errors.</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>If none of the <code>catch</code> handle the error, the error propagates to the surrounding scope. And finally the error must be handled by the top-level scope, otherwise the error will triggers the runtime error.</p><p>Finally handle the errors.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>buySomething</span>(name: String) <span style=color:#66d9ef>throws</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>do</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> machine.vend(name: name)
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>catch</span> VendingMachineError.outOfStack {
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Out of stack&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> buySomething(name: <span style=color:#e6db74>&#34;Cake&#34;</span>)
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>catch</span> VendingMachineError.invaildSelection {
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;insufficientFunds&#34;</span>)
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>catch</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Catch other errors. Otherwise the other errors will trigger runtime error.</span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Other&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Print: Other</span>
</span></span></code></pre></div><p>Write in a better form.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>buySomething</span>(name: String) <span style=color:#66d9ef>throws</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>do</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> machine.vend(name: name)
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>catch</span> <span style=color:#66d9ef>is</span> VendingMachineError {
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Vending Maching have an error.&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-converting-errors-to-optional-values>3. Converting Errors to Optional Values<a hidden class=anchor aria-hidden=true href=#3-converting-errors-to-optional-values>#</a></h3><p>Use <code>try?</code> to convert errors to optional value.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>remain</span>(name: String) <span style=color:#66d9ef>throws</span> -&gt; Int {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> item = machine.inventory[name] {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> item.count
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> VendingMachineError.invaildSelection
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> countOfCake = <span style=color:#66d9ef>try</span>? remain(name: <span style=color:#e6db74>&#34;Cake&#34;</span>)  <span style=color:#75715e>// Use the &#39;try?&#39; to convert the error into a optional value.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> count: Int?
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> count = remain(name: <span style=color:#e6db74>&#34;Cake&#34;</span>)
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>catch</span> <span style=color:#66d9ef>is</span> Error {
</span></span><span style=display:flex><span>    count = <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(countOfCake)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// The countOfCake is equal to the count. They are all optional.</span>
</span></span></code></pre></div><h3 id=4-assert-the-error-not-occur>4. Assert the Error Not Occur<a hidden class=anchor aria-hidden=true href=#4-assert-the-error-not-occur>#</a></h3><p><code>try!</code> return a normal type. If the method/init throws an error, it will crash. Because the returned type will be <code>nil</code> and a normal type cannot handle <code>nil</code>.</p><p><strong>Disabling Error Propagation</strong></p><p>Use the <code>try!</code> to disable error propagation and wrap the call in a runtime assertion</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>remain</span>(name: String) <span style=color:#66d9ef>throws</span> -&gt; Int {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> item = machine.inventory[name] {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> item.count
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> VendingMachineError.invaildSelection
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> c = <span style=color:#66d9ef>try</span>! remain(name: <span style=color:#e6db74>&#34;Cola&#34;</span>) 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> e = <span style=color:#66d9ef>try</span>! remain(name: <span style=color:#e6db74>&#34;Bread&#34;</span>) <span style=color:#75715e>// It will raises a runtime error.</span>
</span></span></code></pre></div><p>A<em>void using <code>try!</code> in most cases since it will break your program.</em></p><h2 id=specifying-cleanup-action>Specifying Cleanup Action<a hidden class=anchor aria-hidden=true href=#specifying-cleanup-action>#</a></h2><p>Use a <code>defer</code> statement to execute a set of statements just before code leaves the current block of code.</p><p>A <code>defer</code> statement defers execution until the current scope is exited, and it has a backward sequence to call the statements in the defer block.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>processFile</span>(name: String) <span style=color:#66d9ef>throws</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> exists(name) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> file = open(name) 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>defer</span> {
</span></span><span style=display:flex><span>            close(file)       <span style=color:#75715e>// Executed third</span>
</span></span><span style=display:flex><span>            doSomething() <span style=color:#75715e>// Executed second</span>
</span></span><span style=display:flex><span>            stop()        <span style=color:#75715e>// Executed first</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>let</span> line = <span style=color:#66d9ef>try</span> file.readline() {
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Here call the stop, doSomething, close</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://1-1.link/tags/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/>编程语言</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Error Handling on twitter" href="https://twitter.com/intent/tweet/?text=Error%20Handling&url=https%3a%2f%2f1-1.link%2fpost%2flanguage%2fswift%2f17error-handling%2f&hashtags=%e7%bc%96%e7%a8%8b%e8%af%ad%e8%a8%80"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Error Handling on reddit" href="https://reddit.com/submit?url=https%3a%2f%2f1-1.link%2fpost%2flanguage%2fswift%2f17error-handling%2f&title=Error%20Handling"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Error Handling on telegram" href="https://telegram.me/share/url?text=Error%20Handling&url=https%3a%2f%2f1-1.link%2fpost%2flanguage%2fswift%2f17error-handling%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://1-1.link>CodePaper</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>